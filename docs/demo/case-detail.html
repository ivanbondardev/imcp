<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case #F1-SEA-2026-02451 — IMCP</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <a href="../index.html" class="sidebar-logo" style="text-decoration: none; color: inherit;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2L2 7l10 5 10-5-10-5z"/>
          <path d="M2 17l10 5 10-5"/>
          <path d="M2 12l10 5 10-5"/>
        </svg>
        <div>
          <h1>IMCP</h1>
          <span>Case Platform</span>
        </div>
      </a>

      <nav>
        <ul class="sidebar-nav">
          <li>
            <a href="owner-dashboard.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
              </svg>
              Owner Dashboard
            </a>
          </li>
          <li>
            <a href="case-list.html" class="active">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
              </svg>
              Кейси
              <span class="nav-badge">12</span>
            </a>
          </li>
          <li>
            <a href="approvals.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 11 12 14 22 4"/>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
              </svg>
              Підтвердження
              <span class="nav-badge">3</span>
            </a>
          </li>
          <li>
            <a href="documents.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
              </svg>
              Документи
            </a>
          </li>
          <li>
            <a href="timeline.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              Таймлайн
            </a>
          </li>
        </ul>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Цей кейс</div>
          <ul class="sidebar-nav">
            <li>
              <a href="#nba">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                Next Best Action
              </a>
            </li>
            <li>
              <a href="#documents">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>
                Документи
              </a>
            </li>
            <li>
              <a href="#timeline">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                Історія
              </a>
            </li>
          </ul>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">Налаштування</div>
          <ul class="sidebar-nav">
            <li>
              <a href="personal-settings.html">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Персональні
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Case Header -->
      <header class="case-header">
        <div class="case-header-top">
          <div class="case-id">
            <a href="case-list.html" class="btn btn-ghost btn-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12 19 5 12 12 5"/>
              </svg>
            </a>
            <span class="case-type-badge">F1_SEA_IMPORT</span>
            F1-SEA-2026-02451
          </div>
          <div class="btn-group">
            <button class="btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="19" cy="12" r="1"/>
                <circle cx="5" cy="12" r="1"/>
              </svg>
              Ще
            </button>
          </div>
        </div>
        <div class="case-meta">
          <div class="case-meta-item">
            <span class="status-badge status-pending">QUOTE_APPROVAL_PENDING</span>
          </div>
          <div class="case-meta-item">
            <span class="status-badge status-open">OPEN</span>
          </div>
          <div class="case-meta-item sla-warning">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            SLA: 2d 4h
          </div>
          <div class="case-meta-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            Owner: Іван П.
          </div>
          <div class="case-meta-item priority-urgent">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            Urgent
          </div>
          <div class="case-meta-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
            </svg>
            Client: ACME Ltd
          </div>
        </div>
      </header>

      <!-- Content -->
      <div class="page-content">
        <!-- Next Best Action -->
        <div class="nba-card" id="nba">
          <span class="help-trigger" data-help="nba-section">?</span>
          <div class="nba-header">
            <span class="nba-indicator"></span>
            <span class="nba-label">Next Best Action</span>
          </div>
          <h3 class="nba-title">Підтвердити калькуляцію (QUOTE_APPROVAL)</h3>
          <div class="nba-description">
            <ul>
              <li>Система підготувала розрахунок ціни</li>
              <li>Термін дії ціни: 7–9 днів</li>
              <li>Base cost: $2,450 + Margin: $350 = Total: $2,800</li>
            </ul>
          </div>
          <div class="nba-risk">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            Ризик: габарити клієнта ще не верифіковані складом
          </div>
          <div class="nba-actions">
            <button class="btn btn-lg">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              Approve
            </button>
            <button class="btn btn-lg btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20h9"/>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
              Edit & Approve
            </button>
            <button class="btn btn-lg btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
              Reject
            </button>
          </div>
        </div>

        <!-- Cockpit Grid -->
        <div class="cockpit-grid">
          <!-- Main Panel -->
          <div class="main-panel">
            <!-- Quote Draft -->
            <div class="quote-draft mb-4">
              <span class="help-trigger" data-help="quote-section">?</span>
              <div class="quote-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="1" x2="12" y2="23"/>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
                <h4>Quote Draft</h4>
                <span class="badge badge-info" style="margin-left: auto;">Version 1</span>
              </div>
              <div class="quote-body">
                <div class="quote-row">
                  <span class="quote-label">Base freight cost</span>
                  <span class="quote-value">$1,850</span>
                </div>
                <div class="quote-row">
                  <span class="quote-label">Terminal handling</span>
                  <span class="quote-value">$350</span>
                </div>
                <div class="quote-row">
                  <span class="quote-label">Documentation fee</span>
                  <span class="quote-value">$150</span>
                </div>
                <div class="quote-row">
                  <span class="quote-label">Insurance (optional)</span>
                  <span class="quote-value">$100</span>
                </div>
                <div class="quote-row">
                  <span class="quote-label" style="font-weight: 500;">Subtotal (Base cost)</span>
                  <span class="quote-value">$2,450</span>
                </div>
                <div class="quote-row">
                  <span class="quote-label">Margin</span>
                  <span class="quote-value">$350</span>
                </div>
                <div class="quote-row total">
                  <span class="quote-label">Total</span>
                  <span class="quote-value" style="color: var(--success);">$2,800</span>
                </div>

                <div class="quote-assumptions">
                  <div class="quote-assumptions-title">Assumptions</div>
                  <ul>
                    <li>Stackable cargo</li>
                    <li>No dangerous goods</li>
                    <li>Standard container load</li>
                    <li>Yiwu → Shenzhen → Odessa → Kyiv</li>
                  </ul>
                </div>

                <div class="quote-notes">
                  <strong>Validity:</strong> 7–9 days from issue date
                </div>
              </div>
            </div>

            <!-- Documents Section -->
            <div class="card mb-4" id="documents">
              <div class="card-header">
                <h4 class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                  Документи
                  <span class="help-trigger" data-help="documents-section">?</span>
                </h4>
                <button class="btn btn-sm btn-primary">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                  </svg>
                  Завантажити
                </button>
              </div>
              <ul class="doc-list">
                <li class="doc-item">
                  <div class="doc-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                    </svg>
                  </div>
                  <div class="doc-info">
                    <div class="doc-name">Contract_ACME_2026.pdf</div>
                    <div class="doc-meta">
                      <span>CONTRACT</span>
                      <span>•</span>
                      <span>CLIENT</span>
                      <span>•</span>
                      <span>2.4 MB</span>
                    </div>
                  </div>
                  <span class="badge badge-success">VERIFIED</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-ghost">View</button>
                  </div>
                </li>
                <li class="doc-item">
                  <div class="doc-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                    </svg>
                  </div>
                  <div class="doc-info">
                    <div class="doc-name">Invoice_INV2026-0451.pdf</div>
                    <div class="doc-meta">
                      <span>INVOICE</span>
                      <span>•</span>
                      <span>ZED</span>
                      <span>•</span>
                      <span>890 KB</span>
                    </div>
                  </div>
                  <span class="badge badge-info">UPLOADED</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-ghost">View</button>
                    <button class="btn btn-sm btn-outline">Verify</button>
                  </div>
                </li>
                <li class="doc-item">
                  <div class="doc-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                    </svg>
                  </div>
                  <div class="doc-info">
                    <div class="doc-name">Packing_List.xlsx</div>
                    <div class="doc-meta">
                      <span>PACKING_LIST</span>
                      <span>•</span>
                      <span>CLIENT</span>
                      <span>•</span>
                      <span>156 KB</span>
                    </div>
                  </div>
                  <span class="badge badge-success">VERIFIED</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-ghost">View</button>
                  </div>
                </li>
              </ul>
            </div>

            <!-- Timeline -->
            <div class="card" id="timeline">
              <div class="card-header">
                <h4 class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                  Timeline
                  <span class="help-trigger" data-help="timeline-section">?</span>
                </h4>
                <a href="timeline.html" class="btn btn-sm btn-ghost">Всі події →</a>
              </div>
              <div class="card-body">
                <div class="timeline">
                  <div class="timeline-item">
                    <div class="timeline-marker system">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <span class="timeline-actor">SYSTEM</span>
                        <span class="timeline-time">12:10 сьогодні</span>
                      </div>
                      <div class="timeline-event">APPROVAL_CREATED</div>
                      <div class="timeline-details">Created QUOTE_APPROVAL for review</div>
                    </div>
                  </div>

                  <div class="timeline-item">
                    <div class="timeline-marker system">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                      </svg>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <span class="timeline-actor">SYSTEM</span>
                        <span class="timeline-time">12:10 сьогодні</span>
                      </div>
                      <div class="timeline-event">STATE_CHANGED</div>
                      <div class="timeline-details">QUOTE_READY → QUOTE_APPROVAL_PENDING</div>
                    </div>
                  </div>

                  <div class="timeline-item">
                    <div class="timeline-marker system">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                      </svg>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <span class="timeline-actor">SYSTEM</span>
                        <span class="timeline-time">12:08 сьогодні</span>
                      </div>
                      <div class="timeline-event">QUOTE_CALCULATED</div>
                      <div class="timeline-details">Quote draft generated: $2,800 total</div>
                    </div>
                  </div>

                  <div class="timeline-item">
                    <div class="timeline-marker human">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                      </svg>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <span class="timeline-actor">HUMAN (Іван П.)</span>
                        <span class="timeline-time">11:42 сьогодні</span>
                      </div>
                      <div class="timeline-event">STATE_CHANGED</div>
                      <div class="timeline-details">CLIENT_INFO_COLLECTED → QUOTE_READY (all required fields confirmed)</div>
                    </div>
                  </div>

                  <div class="timeline-item">
                    <div class="timeline-marker ai">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/>
                      </svg>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <span class="timeline-actor">AI</span>
                        <span class="timeline-time">10:30 сьогодні</span>
                      </div>
                      <div class="timeline-event">DOC_EXTRACTED</div>
                      <div class="timeline-details">Extracted cargo data from email attachment (confidence: 92%)</div>
                    </div>
                  </div>

                  <div class="timeline-item">
                    <div class="timeline-marker human">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                      </svg>
                    </div>
                    <div class="timeline-content">
                      <div class="timeline-header">
                        <span class="timeline-actor">HUMAN (Іван П.)</span>
                        <span class="timeline-time">09:55 сьогодні</span>
                      </div>
                      <div class="timeline-event">CASE_CREATED</div>
                      <div class="timeline-details">Case created from client request</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Context Sidebar -->
          <div class="context-sidebar">
            <!-- Cargo Summary -->
            <div class="card context-card">
              <span class="help-trigger" data-help="cargo-summary">?</span>
              <div class="context-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                </svg>
                Cargo Summary
              </div>
              <div class="context-card-body">
                <div class="context-item">
                  <span class="context-item-label">Packages</span>
                  <span class="context-item-value">12</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Declared dims</span>
                  <span class="context-item-value">3.2 cbm</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Weight</span>
                  <span class="context-item-value">450 kg</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Stackable</span>
                  <span class="context-item-value">Yes</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Dangerous</span>
                  <span class="context-item-value">No</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Description</span>
                  <span class="context-item-value">Consumer electronics</span>
                </div>
              </div>
            </div>

            <!-- Route Info -->
            <div class="card context-card">
              <span class="help-trigger" data-help="route-info">?</span>
              <div class="context-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M2 12h20"/>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
                Route
              </div>
              <div class="context-card-body">
                <div class="context-item">
                  <span class="context-item-label">Mode</span>
                  <span class="context-item-value">SEA</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Origin</span>
                  <span class="context-item-value">Yiwu Warehouse</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Port</span>
                  <span class="context-item-value">Shenzhen</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Destination</span>
                  <span class="context-item-value">Kyiv</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Terminal</span>
                  <span class="context-item-value">Terminal X</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Broker</span>
                  <span class="context-item-value">Our broker</span>
                </div>
              </div>
            </div>

            <!-- Client Info -->
            <div class="card context-card">
              <div class="context-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
                Client
              </div>
              <div class="context-card-body">
                <div class="context-item">
                  <span class="context-item-label">Company</span>
                  <span class="context-item-value">ACME Ltd</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Contact</span>
                  <span class="context-item-value">John Smith</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Email</span>
                  <span class="context-item-value">john@acme.com</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Phone</span>
                  <span class="context-item-value">+380 50 123 4567</span>
                </div>
              </div>
            </div>

            <!-- Key Dates -->
            <div class="card context-card">
              <div class="context-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Key Dates
              </div>
              <div class="context-card-body">
                <div class="context-item">
                  <span class="context-item-label">Cargo ready</span>
                  <span class="context-item-value">2026-02-10</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Created</span>
                  <span class="context-item-value">2026-02-05</span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">SLA deadline</span>
                  <span class="context-item-value">2026-02-07</span>
                </div>
              </div>
            </div>

            <!-- Risk Flags -->
            <div class="card context-card">
              <span class="help-trigger" data-help="risk-flags">?</span>
              <div class="context-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                  <line x1="12" y1="9" x2="12" y2="13"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                Risk Flags
              </div>
              <div class="context-card-body" style="padding: 10px;">
                <div class="risk-flag risk-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <span>Dimensions not verified by warehouse</span>
                </div>
                <div class="risk-flag risk-low">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  <span>No dangerous goods declared</span>
                </div>
              </div>
            </div>

            <!-- Integration IDs -->
            <div class="card context-card">
              <span class="help-trigger" data-help="integration-ids">?</span>
              <div class="context-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="16 18 22 12 16 6"/>
                  <polyline points="8 6 2 12 8 18"/>
                </svg>
                Integration IDs
              </div>
              <div class="context-card-body">
                <div class="context-item">
                  <span class="context-item-label">1C Request</span>
                  <span class="context-item-value"><code>REQ-2026-02451</code></span>
                </div>
                <div class="context-item">
                  <span class="context-item-label">Marking</span>
                  <span class="context-item-value"><code>ALEX-02451</code></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <style>
    /* ===== Onboarding Tips System ===== */
    .tip {
      position: absolute;
      background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
      color: white;
      padding: 12px 16px;
      border-radius: var(--radius-lg);
      font-size: 12px;
      max-width: 280px;
      box-shadow: 0 8px 32px rgba(0, 120, 212, 0.3);
      z-index: 100;
      animation: tipPulse 0.4s ease-out, tipGlow 2s ease-in-out infinite;
    }

    @keyframes tipPulse {
      0% { opacity: 0; transform: scale(0.9) translateY(10px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }

    @keyframes tipGlow {
      0%, 100% { box-shadow: 0 8px 32px rgba(0, 120, 212, 0.3); }
      50% { box-shadow: 0 8px 40px rgba(0, 120, 212, 0.5); }
    }

    .tip.hiding {
      animation: tipHide 0.3s ease-in forwards;
    }

    @keyframes tipHide {
      to { opacity: 0; transform: scale(0.95) translateY(-10px); }
    }

    .tip-content {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .tip-icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tip-icon svg { width: 14px; height: 14px; }

    .tip-text { flex: 1; }

    .tip-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .tip-description {
      opacity: 0.9;
      line-height: 1.4;
    }

    .tip-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .tip-close:hover { background: rgba(255, 255, 255, 0.35); }
    .tip-close svg { width: 12px; height: 12px; }

    .tip::before {
      content: '';
      position: absolute;
      width: 12px;
      height: 12px;
      background: inherit;
      transform: rotate(45deg);
    }

    .tip.arrow-top::before { top: -6px; left: 24px; }
    .tip.arrow-bottom::before { bottom: -6px; left: 24px; }
    .tip.arrow-left::before { left: -6px; top: 16px; }
    .tip.arrow-right::before { right: -6px; top: 16px; }

    .tip-step {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      opacity: 0.75;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .tip-step-dots { display: flex; gap: 4px; }

    .tip-step-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
    }

    .tip-step-dot.active { background: white; }

    .tip-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .tip-btn {
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }

    .tip-btn-primary { background: white; color: #005a9e; }
    .tip-btn-primary:hover { background: rgba(255, 255, 255, 0.9); }
    .tip-btn-secondary { background: rgba(255, 255, 255, 0.15); color: white; }
    .tip-btn-secondary:hover { background: rgba(255, 255, 255, 0.25); }

    .tips-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 99;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .tips-overlay.active { opacity: 1; pointer-events: auto; }

    .tip-highlight {
      position: relative;
      z-index: 101;
      box-shadow: 0 0 0 4px rgba(0, 120, 212, 0.4);
      border-radius: var(--radius-md);
    }

    .show-tips-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: var(--radius-lg);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-md);
      transition: all 0.2s;
      z-index: 50;
    }

    .show-tips-btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-popup);
    }

    .show-tips-btn svg { width: 16px; height: 16px; }

    /* ===== Static Help Triggers ===== */
    .help-trigger {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      background: var(--bg-hover);
      border: 1px solid var(--divider);
      border-radius: 50%;
      color: var(--text-muted);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-left: 6px;
      flex-shrink: 0;
    }

    .help-trigger:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      transform: scale(1.1);
    }

    .help-trigger.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .help-popup {
      position: absolute;
      background: var(--bg-editor);
      border: 1px solid var(--divider);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-popup);
      padding: 12px 14px;
      font-size: 12px;
      max-width: 300px;
      z-index: 200;
      animation: helpPopupIn 0.2s ease;
    }

    @keyframes helpPopupIn {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .help-popup.closing {
      animation: helpPopupOut 0.15s ease forwards;
    }

    @keyframes helpPopupOut {
      to { opacity: 0; transform: translateY(-8px); }
    }

    .help-popup::before {
      content: '';
      position: absolute;
      top: -6px;
      left: 20px;
      width: 10px;
      height: 10px;
      background: var(--bg-editor);
      border-left: 1px solid var(--divider);
      border-top: 1px solid var(--divider);
      transform: rotate(45deg);
    }

    .help-popup.arrow-bottom::before {
      top: auto;
      bottom: -6px;
      border-left: none;
      border-top: none;
      border-right: 1px solid var(--divider);
      border-bottom: 1px solid var(--divider);
    }

    .help-popup-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--divider);
    }

    .help-popup-icon {
      width: 24px;
      height: 24px;
      background: var(--accent-light);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
    }

    .help-popup-icon svg { width: 14px; height: 14px; }

    .help-popup-title { font-weight: 600; color: var(--text); }

    .help-popup-content {
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .help-popup-content ul {
      margin: 8px 0 0 0;
      padding-left: 16px;
    }

    .help-popup-content li { margin-bottom: 4px; }

    .help-popup-content code {
      background: var(--bg-panel);
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 11px;
      font-family: var(--font-mono);
    }

    .help-popup-footer {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid var(--divider);
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .help-popup-footer kbd {
      background: var(--bg-panel);
      border: 1px solid var(--divider);
      border-radius: 3px;
      padding: 1px 5px;
      font-size: 10px;
      font-family: var(--font-mono);
    }

    /* Positioning helpers */
    .case-header { position: relative; }
    .nba-card { position: relative; }
    .quote-draft { position: relative; }
    .context-card { position: relative; }
    .card { position: relative; }

    .case-header .help-trigger,
    .nba-card .help-trigger,
    .quote-draft .help-trigger {
      position: absolute;
      top: 12px;
      right: 12px;
    }

    .context-card .help-trigger {
      position: absolute;
      top: 8px;
      right: 8px;
    }

    .card-header .help-trigger {
      margin-left: auto;
    }
  </style>

  <script>
    // ===== ONBOARDING TIPS SYSTEM =====
    const TipsManager = {
      storageKey: 'imcp_case_detail_tips',
      tips: [],
      currentStep: 0,
      tourMode: false,

      init() {
        this.loadState();
        this.createTips();
        this.createShowTipsButton();
        
        setTimeout(() => {
          if (!this.allTipsDismissed()) {
            this.showInitialTips();
          }
        }, 500);
      },

      loadState() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          this.dismissedTips = saved ? JSON.parse(saved) : {};
        } catch (e) {
          this.dismissedTips = {};
        }
      },

      saveState() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.dismissedTips));
        } catch (e) {}
      },

      allTipsDismissed() {
        return this.tips.every(tip => this.dismissedTips[tip.id]);
      },

      createTips() {
        this.tips = [
          {
            id: 'tip-nba',
            targetSelector: '.nba-card',
            title: 'Next Best Action',
            description: 'Головна дія, яку потрібно виконати для просування кейсу. Система автоматично визначає наступний крок.',
            position: 'bottom-left',
            arrow: 'top',
            icon: 'bolt'
          },
          {
            id: 'tip-quote',
            targetSelector: '.quote-draft',
            title: 'Quote Draft',
            description: 'Розрахунок ціни для клієнта. Перевірте всі позиції перед підтвердженням.',
            position: 'bottom-left',
            arrow: 'top',
            icon: 'dollar'
          },
          {
            id: 'tip-context',
            targetSelector: '.context-sidebar',
            title: 'Контекстна інформація',
            description: 'Всі дані про вантаж, маршрут, клієнта та ризики зібрані в бічній панелі для швидкого доступу.',
            position: 'left',
            arrow: 'right',
            icon: 'info'
          },
          {
            id: 'tip-timeline',
            targetSelector: '#timeline',
            title: 'Історія подій',
            description: 'Хронологія всіх дій: системних, людських та AI. Допомагає зрозуміти, що відбувалося з кейсом.',
            position: 'inside-top',
            arrow: 'none',
            icon: 'clock'
          }
        ];
      },

      createShowTipsButton() {
        const btn = document.createElement('button');
        btn.className = 'show-tips-btn';
        btn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          Підказки
        `;
        btn.onclick = () => this.startTour();
        document.body.appendChild(btn);
      },

      showInitialTips() {
        const firstActiveTip = this.tips.find(tip => !this.dismissedTips[tip.id]);
        if (firstActiveTip) {
          this.showTip(firstActiveTip, false);
        }
      },

      showTip(tipConfig, isTour = false) {
        const target = document.querySelector(tipConfig.targetSelector);
        if (!target) return;

        this.hideAllTips();

        const tip = document.createElement('div');
        tip.className = `tip arrow-${tipConfig.arrow}`;
        tip.dataset.tipId = tipConfig.id;

        const iconSvg = this.getIcon(tipConfig.icon);
        const stepIndicator = isTour ? this.getStepIndicator() : '';

        tip.innerHTML = `
          <button class="tip-close" onclick="TipsManager.dismissTip('${tipConfig.id}')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
          <div class="tip-content">
            <div class="tip-icon">${iconSvg}</div>
            <div class="tip-text">
              <div class="tip-title">${tipConfig.title}</div>
              <div class="tip-description">${tipConfig.description}</div>
              ${isTour ? `
                <div class="tip-actions">
                  ${this.currentStep > 0 ? '<button class="tip-btn tip-btn-secondary" onclick="TipsManager.prevStep()">← Назад</button>' : ''}
                  ${this.currentStep < this.tips.length - 1 
                    ? '<button class="tip-btn tip-btn-primary" onclick="TipsManager.nextStep()">Далі →</button>'
                    : '<button class="tip-btn tip-btn-primary" onclick="TipsManager.endTour()">Готово ✓</button>'}
                </div>
              ` : ''}
              ${stepIndicator}
            </div>
          </div>
        `;

        document.body.appendChild(tip);
        this.positionTip(tip, target, tipConfig.position);

        if (isTour) {
          target.classList.add('tip-highlight');
        }
      },

      positionTip(tip, target, position) {
        const targetRect = target.getBoundingClientRect();
        const tipRect = tip.getBoundingClientRect();
        let top, left;

        switch (position) {
          case 'bottom-right':
            top = targetRect.bottom + 12;
            left = targetRect.right - tipRect.width;
            break;
          case 'bottom-left':
            top = targetRect.bottom + 12;
            left = targetRect.left;
            break;
          case 'inside-top':
            top = targetRect.top + 60;
            left = targetRect.left + 20;
            break;
          case 'right':
            top = targetRect.top;
            left = targetRect.right + 12;
            break;
          case 'left':
            top = targetRect.top;
            left = targetRect.left - tipRect.width - 12;
            break;
          default:
            top = targetRect.bottom + 12;
            left = targetRect.left;
        }

        const padding = 16;
        left = Math.max(padding, Math.min(left, window.innerWidth - tipRect.width - padding));
        top = Math.max(padding, Math.min(top, window.innerHeight - tipRect.height - padding));

        tip.style.position = 'fixed';
        tip.style.top = `${top}px`;
        tip.style.left = `${left}px`;
      },

      getIcon(iconName) {
        const icons = {
          bolt: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
          dollar: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',
          info: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>',
          clock: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
          check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>'
        };
        return icons[iconName] || icons.info;
      },

      getStepIndicator() {
        if (!this.tourMode) return '';
        const dots = this.tips.map((_, i) => 
          `<span class="tip-step-dot ${i === this.currentStep ? 'active' : ''}"></span>`
        ).join('');
        return `<div class="tip-step"><div class="tip-step-dots">${dots}</div><span>${this.currentStep + 1} з ${this.tips.length}</span></div>`;
      },

      dismissTip(tipId) {
        const tip = document.querySelector(`[data-tip-id="${tipId}"]`);
        if (tip) {
          tip.classList.add('hiding');
          setTimeout(() => tip.remove(), 300);
        }
        this.dismissedTips[tipId] = true;
        this.saveState();
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
        if (this.tourMode) this.endTour();
      },

      hideAllTips() {
        document.querySelectorAll('.tip').forEach(tip => tip.remove());
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
      },

      startTour() {
        this.tourMode = true;
        this.currentStep = 0;
        
        let overlay = document.querySelector('.tips-overlay');
        if (!overlay) {
          overlay = document.createElement('div');
          overlay.className = 'tips-overlay';
          overlay.onclick = () => this.endTour();
          document.body.appendChild(overlay);
        }
        overlay.classList.add('active');
        this.showCurrentTourStep();
      },

      showCurrentTourStep() {
        if (this.currentStep >= 0 && this.currentStep < this.tips.length) {
          this.showTip(this.tips[this.currentStep], true);
          const target = document.querySelector(this.tips[this.currentStep].targetSelector);
          if (target) target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      },

      nextStep() {
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
        this.currentStep++;
        if (this.currentStep < this.tips.length) {
          this.showCurrentTourStep();
        } else {
          this.endTour();
        }
      },

      prevStep() {
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showCurrentTourStep();
        }
      },

      endTour() {
        this.tourMode = false;
        this.hideAllTips();
        const overlay = document.querySelector('.tips-overlay');
        if (overlay) overlay.classList.remove('active');
      },

      resetAllTips() {
        this.dismissedTips = {};
        this.saveState();
        this.showInitialTips();
      }
    };

    // ===== STATIC HELP SYSTEM =====
    const HelpManager = {
      activePopup: null,
      activeTrigger: null,

      helpContent: {
        'case-header': {
          title: 'Заголовок кейсу',
          icon: 'folder',
          content: `
            <p>Основна інформація про кейс:</p>
            <ul>
              <li><strong>Case ID</strong> — унікальний номер</li>
              <li><strong>Статус</strong> — поточний стан</li>
              <li><strong>SLA</strong> — час до дедлайну</li>
              <li><strong>Owner</strong> — відповідальний менеджер</li>
            </ul>
          `
        },
        'nba-section': {
          title: 'Next Best Action (NBA)',
          icon: 'bolt',
          content: `
            <p>Система автоматично визначає наступну дію для просування кейсу.</p>
            <p><strong>Кнопки дій:</strong></p>
            <ul>
              <li><strong>Approve</strong> — підтвердити без змін</li>
              <li><strong>Edit & Approve</strong> — редагувати та підтвердити</li>
              <li><strong>Reject</strong> — відхилити з причиною</li>
            </ul>
          `
        },
        'quote-section': {
          title: 'Quote Draft',
          icon: 'dollar',
          content: `
            <p>Калькуляція вартості перевезення для клієнта.</p>
            <ul>
              <li><strong>Base cost</strong> — собівартість послуг</li>
              <li><strong>Margin</strong> — маржа компанії</li>
              <li><strong>Assumptions</strong> — умови розрахунку</li>
              <li><strong>Validity</strong> — термін дії ціни</li>
            </ul>
          `
        },
        'documents-section': {
          title: 'Документи кейсу',
          icon: 'file',
          content: `
            <p>Всі документи, прикріплені до кейсу.</p>
            <p><strong>Статуси документів:</strong></p>
            <ul>
              <li>🟢 <strong>VERIFIED</strong> — перевірено</li>
              <li>🔵 <strong>UPLOADED</strong> — завантажено</li>
              <li>🟡 <strong>PENDING</strong> — очікує перевірки</li>
            </ul>
          `
        },
        'timeline-section': {
          title: 'Timeline (Історія)',
          icon: 'clock',
          content: `
            <p>Хронологія всіх подій кейсу.</p>
            <p><strong>Типи акторів:</strong></p>
            <ul>
              <li>⚙️ <strong>SYSTEM</strong> — автоматичні дії</li>
              <li>👤 <strong>HUMAN</strong> — дії менеджера</li>
              <li>🤖 <strong>AI</strong> — дії штучного інтелекту</li>
            </ul>
          `
        },
        'cargo-summary': {
          title: 'Cargo Summary',
          icon: 'box',
          content: `
            <p>Характеристики вантажу:</p>
            <ul>
              <li><strong>Packages</strong> — кількість місць</li>
              <li><strong>Dims</strong> — об'єм у кубічних метрах</li>
              <li><strong>Weight</strong> — вага в кілограмах</li>
              <li><strong>Stackable</strong> — чи можна штабелювати</li>
            </ul>
          `
        },
        'route-info': {
          title: 'Route (Маршрут)',
          icon: 'globe',
          content: `
            <p>Інформація про маршрут перевезення:</p>
            <ul>
              <li><strong>Origin</strong> — склад відправлення</li>
              <li><strong>Port</strong> — порт завантаження</li>
              <li><strong>Destination</strong> — місто доставки</li>
              <li><strong>Broker</strong> — хто виконує митне оформлення</li>
            </ul>
          `
        },
        'risk-flags': {
          title: 'Risk Flags',
          icon: 'alert',
          content: `
            <p>Ризики та попередження для кейсу.</p>
            <p><strong>Рівні ризику:</strong></p>
            <ul>
              <li>🔴 <strong>High</strong> — критичний, потребує уваги</li>
              <li>🟡 <strong>Medium</strong> — помірний ризик</li>
              <li>🟢 <strong>Low</strong> — інформаційний</li>
            </ul>
          `
        },
        'integration-ids': {
          title: 'Integration IDs',
          icon: 'code',
          content: `
            <p>Ідентифікатори в зовнішніх системах:</p>
            <ul>
              <li><strong>1C Request</strong> — номер заявки в 1С</li>
              <li><strong>Marking</strong> — маркування на складі</li>
            </ul>
            <p>Використовуйте для пошуку в інших системах.</p>
          `
        }
      },

      init() {
        this.bindEvents();
      },

      bindEvents() {
        document.addEventListener('click', (e) => {
          const trigger = e.target.closest('.help-trigger');
          
          if (trigger) {
            e.preventDefault();
            e.stopPropagation();
            const helpId = trigger.dataset.help;
            if (helpId) this.togglePopup(helpId, trigger);
            return;
          }

          if (this.activePopup && !e.target.closest('.help-popup')) {
            this.closePopup();
          }
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.activePopup) {
            this.closePopup();
          }
        });
      },

      togglePopup(helpId, trigger) {
        if (this.activeTrigger === trigger) {
          this.closePopup();
          return;
        }

        this.closePopup();

        const content = this.helpContent[helpId];
        if (!content) return;

        const popup = document.createElement('div');
        popup.className = 'help-popup';
        popup.innerHTML = `
          <div class="help-popup-header">
            <div class="help-popup-icon">${this.getIcon(content.icon)}</div>
            <div class="help-popup-title">${content.title}</div>
          </div>
          <div class="help-popup-content">${content.content}</div>
        `;

        document.body.appendChild(popup);
        this.positionPopup(popup, trigger);

        this.activePopup = popup;
        this.activeTrigger = trigger;
        trigger.classList.add('active');
      },

      positionPopup(popup, trigger) {
        const triggerRect = trigger.getBoundingClientRect();
        const popupRect = popup.getBoundingClientRect();

        let top = triggerRect.bottom + 8;
        let left = triggerRect.left - 10;

        if (left + popupRect.width > window.innerWidth - 16) {
          left = window.innerWidth - popupRect.width - 16;
        }

        if (top + popupRect.height > window.innerHeight - 16) {
          top = triggerRect.top - popupRect.height - 8;
          popup.classList.add('arrow-bottom');
        }

        left = Math.max(16, left);

        popup.style.position = 'fixed';
        popup.style.top = `${top}px`;
        popup.style.left = `${left}px`;
      },

      closePopup() {
        if (this.activePopup) {
          this.activePopup.classList.add('closing');
          setTimeout(() => {
            if (this.activePopup) {
              this.activePopup.remove();
              this.activePopup = null;
            }
          }, 150);
        }
        if (this.activeTrigger) {
          this.activeTrigger.classList.remove('active');
          this.activeTrigger = null;
        }
      },

      getIcon(iconName) {
        const icons = {
          info: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>',
          bolt: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
          dollar: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',
          file: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>',
          clock: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
          box: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>',
          globe: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>',
          alert: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
          folder: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>',
          code: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>'
        };
        return icons[iconName] || icons.info;
      }
    };

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      TipsManager.init();
      HelpManager.init();
    });
  </script>
</body>
</html>
