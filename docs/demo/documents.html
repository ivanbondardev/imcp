<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documents ‚Äî IMCP</title>
  <link rel="stylesheet" href="styles.css">
  <!-- SheetJS for Excel file reading -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <a href="../index.html" class="sidebar-logo" style="text-decoration: none; color: inherit;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2L2 7l10 5 10-5-10-5z"/>
          <path d="M2 17l10 5 10-5"/>
          <path d="M2 12l10 5 10-5"/>
        </svg>
        <div>
          <h1>IMCP</h1>
          <span>Case Platform</span>
        </div>
      </a>

      <nav>
        <ul class="sidebar-nav">
          <li>
            <a href="owner-dashboard.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
              </svg>
              Owner Dashboard
            </a>
          </li>
          <li>
            <a href="engineering-dashboard.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
              </svg>
              Engineering
            </a>
          </li>
          <li>
            <a href="case-list.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
              </svg>
              –ö–µ–π—Å–∏
              <span class="nav-badge">12</span>
            </a>
          </li>
          <li>
            <a href="approvals.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 11 12 14 22 4"/>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
              </svg>
              –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
              <span class="nav-badge">3</span>
            </a>
          </li>
          <li>
            <a href="documents.html" class="active">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
              </svg>
              –î–æ–∫—É–º–µ–Ω—Ç–∏
            </a>
          </li>
          <li>
            <a href="timeline.html">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              –¢–∞–π–º–ª–∞–π–Ω
            </a>
          </li>
        </ul>

        <div class="sidebar-section">
          <div class="sidebar-section-title">–§—ñ–ª—å—Ç—Ä–∏</div>
          <ul class="sidebar-nav">
            <li>
              <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                –ù–µ—â–æ–¥–∞–≤–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ
              </a>
            </li>
            <li>
              <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="9 11 12 14 22 4"/>
                  <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
                –ü–æ—Ç—Ä–µ–±—É—é—Ç—å –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
                <span class="nav-badge">4</span>
              </a>
            </li>
            <li>
              <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                –í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ
              </a>
            </li>
          </ul>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</div>
          <ul class="sidebar-nav">
            <li>
              <a href="personal-settings.html">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="page-header">
        <div class="flex items-center justify-between">
          <div style="display: flex; align-items: center;">
            <div>
              <h2>–î–æ–∫—É–º–µ–Ω—Ç–∏</h2>
              <p class="text-sm text-muted">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∫–µ–π—Å—ñ–≤</p>
            </div>
            <span class="help-trigger" data-help="documents-page" style="margin-left: 12px;">?</span>
          </div>
          <div class="btn-group">
            <button class="btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
              </svg>
              –§—ñ–ª—å—Ç—Ä–∏
            </button>
            <button class="btn btn-primary" data-upload-trigger>
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
            </button>
          </div>
        </div>
      </header>

      <!-- Content -->
      <div class="page-content">
        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <span class="help-trigger" data-help="needs-verification">?</span>
            <div class="stat-header">
              <span class="stat-label">–ü–æ—Ç—Ä–µ–±—É—é—Ç—å –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</span>
              <div class="stat-icon warning">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">4</div>
            <div class="stat-change negative">AI extracted, needs human check</div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <span class="stat-label">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Å—å–æ–≥–æ–¥–Ω—ñ</span>
              <div class="stat-icon primary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">8</div>
            <div class="stat-change positive">+3 vs –≤—á–æ—Ä–∞</div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <span class="stat-label">–í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ</span>
              <div class="stat-icon success">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">156</div>
            <div class="stat-change">–¶—å–æ–≥–æ –º—ñ—Å—è—Ü—è</div>
          </div>

          <div class="stat-card">
            <span class="help-trigger" data-help="extraction-rate">?</span>
            <div class="stat-header">
              <span class="stat-label">AI Extraction Rate</span>
              <div class="stat-icon info">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">89%</div>
            <div class="stat-change positive">Avg confidence</div>
          </div>
        </div>

        <!-- Needs Verification Section -->
        <div class="inbox-section">
          <div class="inbox-section-header">
            <h3 class="inbox-section-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--warning);">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              –ü–æ—Ç—Ä–µ–±—É—é—Ç—å –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
              <span class="inbox-section-count">4</span>
              <span class="help-trigger" data-help="ai-confidence">?</span>
            </h3>
          </div>

          <div class="card">
            <ul class="doc-list">
              <li class="doc-item">
                <div class="doc-icon" style="background: var(--warning-bg); color: var(--warning-text);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                </div>
                <div class="doc-info">
                  <div class="doc-name">Invoice_INV2026-0451.pdf</div>
                  <div class="doc-meta">
                    <span>INVOICE</span>
                    <span>‚Ä¢</span>
                    <span>ZED</span>
                    <span>‚Ä¢</span>
                    <span>Case: F1-SEA-2026-02451</span>
                    <span>‚Ä¢</span>
                    <span>AI: 92% confidence</span>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="badge badge-warning">NEEDS VERIFICATION</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-primary" data-doc-view data-doc-name="Invoice_INV2026-0451.pdf" data-doc-type="INVOICE" data-doc-source="ZED" data-doc-case="F1-SEA-2026-02451" data-doc-confidence="92" data-doc-file="Invoice_INV2026-0451.pdf" data-doc-status="NEEDS_VERIFICATION">Review</button>
                  </div>
                </div>
              </li>
              <li class="doc-item">
                <div class="doc-icon" style="background: var(--warning-bg); color: var(--warning-text);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                </div>
                <div class="doc-info">
                  <div class="doc-name">BL_Draft_MSKU1234567890.pdf</div>
                  <div class="doc-meta">
                    <span>BL_DRAFT</span>
                    <span>‚Ä¢</span>
                    <span>ZED</span>
                    <span>‚Ä¢</span>
                    <span>Case: F1-SEA-2026-02445</span>
                    <span>‚Ä¢</span>
                    <span style="color: var(--warning);">AI: 76% confidence</span>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="badge badge-danger">LOW CONFIDENCE</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-warning" data-doc-view data-doc-name="BL_Draft_MSKU1234567890.pdf" data-doc-type="BL_DRAFT" data-doc-source="ZED" data-doc-case="F1-SEA-2026-02445" data-doc-confidence="76" data-doc-file="BL_Draft_MSKU1234567890.pdf" data-doc-status="LOW_CONFIDENCE">Review</button>
                  </div>
                </div>
              </li>
              <li class="doc-item">
                <div class="doc-icon" style="background: var(--warning-bg); color: var(--warning-text);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                </div>
                <div class="doc-info">
                  <div class="doc-name">Packing_List_GT2026.xlsx</div>
                  <div class="doc-meta">
                    <span>PACKING_LIST</span>
                    <span>‚Ä¢</span>
                    <span>CLIENT</span>
                    <span>‚Ä¢</span>
                    <span>Case: F1-SEA-2026-02448</span>
                    <span>‚Ä¢</span>
                    <span>AI: 88% confidence</span>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="badge badge-warning">NEEDS VERIFICATION</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-primary" data-doc-view data-doc-name="Packing_List_GT2026.xlsx" data-doc-type="PACKING_LIST" data-doc-source="CLIENT" data-doc-case="F1-SEA-2026-02448" data-doc-confidence="88" data-doc-file="Packing_List_GT2026.xlsx" data-doc-status="NEEDS_VERIFICATION">Review</button>
                  </div>
                </div>
              </li>
              <li class="doc-item">
                <div class="doc-icon" style="background: var(--warning-bg); color: var(--warning-text);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                </div>
                <div class="doc-info">
                  <div class="doc-name">POA_Scan_TechImport.pdf</div>
                  <div class="doc-meta">
                    <span>POA</span>
                    <span>‚Ä¢</span>
                    <span>CLIENT</span>
                    <span>‚Ä¢</span>
                    <span>Case: F1-SEA-2026-02445</span>
                    <span>‚Ä¢</span>
                    <span>AI: 91% confidence</span>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="badge badge-warning">NEEDS VERIFICATION</span>
                  <div class="doc-actions">
                    <button class="btn btn-sm btn-primary" data-doc-view data-doc-name="POA_Scan_TechImport.pdf" data-doc-type="POA" data-doc-source="CLIENT" data-doc-case="F1-SEA-2026-02445" data-doc-confidence="91" data-doc-file="POA_Scan_TechImport.pdf" data-doc-status="NEEDS_VERIFICATION">Review</button>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <!-- Recently Uploaded Section -->
        <div class="inbox-section">
          <div class="inbox-section-header">
            <h3 class="inbox-section-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent);">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              –ù–µ—â–æ–¥–∞–≤–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ
            </h3>
          </div>

          <div class="card">
            <div class="table-container">
              <table class="table">
                <thead>
                  <tr>
                    <th>–î–æ–∫—É–º–µ–Ω—Ç</th>
                    <th>–¢–∏–ø</th>
                    <th>Case</th>
                    <th>–î–∂–µ—Ä–µ–ª–æ</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div class="flex items-center gap-3">
                        <div class="doc-icon" style="width: 28px; height: 28px;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                          </svg>
                        </div>
                        <span style="font-weight: 500;">Contract_ACME_2026.pdf</span>
                      </div>
                    </td>
                    <td><span class="badge badge-gray">CONTRACT</span></td>
                    <td><a href="case-detail.html" style="color: var(--accent); text-decoration: none;">F1-SEA-2026-02451</a></td>
                    <td>CLIENT</td>
                    <td><span class="badge badge-success">VERIFIED</span></td>
                    <td>–°—å–æ–≥–æ–¥–Ω—ñ, 11:30</td>
                    <td><button class="btn btn-sm btn-ghost" data-doc-view data-doc-name="Contract_ACME_2026.pdf" data-doc-type="CONTRACT" data-doc-source="CLIENT" data-doc-case="F1-SEA-2026-02451" data-doc-confidence="97" data-doc-file="Contract ACME-2026-0451.pdf" data-doc-status="VERIFIED">View</button></td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center gap-3">
                        <div class="doc-icon" style="width: 28px; height: 28px;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                          </svg>
                        </div>
                        <span style="font-weight: 500;">Invoice_INV2026-0392.pdf</span>
                      </div>
                    </td>
                    <td><span class="badge badge-gray">INVOICE</span></td>
                    <td><a href="case-detail.html" style="color: var(--accent); text-decoration: none;">F1-SEA-2026-02447</a></td>
                    <td>ZED</td>
                    <td><span class="badge badge-info">PROCESSING</span></td>
                    <td>–°—å–æ–≥–æ–¥–Ω—ñ, 10:45</td>
                    <td><button class="btn btn-sm btn-ghost" data-doc-view data-doc-name="Invoice_INV2026-0392.pdf" data-doc-type="INVOICE" data-doc-source="ZED" data-doc-case="F1-SEA-2026-02447" data-doc-confidence="" data-doc-file="Invoice_INV2026-0451.pdf" data-doc-status="PROCESSING">View</button></td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center gap-3">
                        <div class="doc-icon" style="width: 28px; height: 28px;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                          </svg>
                        </div>
                        <span style="font-weight: 500;">Packing_List.xlsx</span>
                      </div>
                    </td>
                    <td><span class="badge badge-gray">PACKING_LIST</span></td>
                    <td><a href="case-detail.html" style="color: var(--accent); text-decoration: none;">F1-SEA-2026-02451</a></td>
                    <td>CLIENT</td>
                    <td><span class="badge badge-success">VERIFIED</span></td>
                    <td>–°—å–æ–≥–æ–¥–Ω—ñ, 09:20</td>
                    <td><button class="btn btn-sm btn-ghost" data-doc-view data-doc-name="Packing_List.xlsx" data-doc-type="PACKING_LIST" data-doc-source="CLIENT" data-doc-case="F1-SEA-2026-02451" data-doc-confidence="95" data-doc-file="Packing_List_GT2026.xlsx" data-doc-status="VERIFIED">View</button></td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center gap-3">
                        <div class="doc-icon" style="width: 28px; height: 28px;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                          </svg>
                        </div>
                        <span style="font-weight: 500;">BL_Draft_MSKU9876543210.pdf</span>
                      </div>
                    </td>
                    <td><span class="badge badge-gray">BL_DRAFT</span></td>
                    <td><a href="case-detail.html" style="color: var(--accent); text-decoration: none;">F1-SEA-2026-02446</a></td>
                    <td>ZED</td>
                    <td><span class="badge badge-success">VERIFIED</span></td>
                    <td>–í—á–æ—Ä–∞, 16:10</td>
                    <td><button class="btn btn-sm btn-ghost" data-doc-view data-doc-name="BL_Draft_MSKU9876543210.pdf" data-doc-type="BL_DRAFT" data-doc-source="ZED" data-doc-case="F1-SEA-2026-02446" data-doc-confidence="97" data-doc-file="BL_Draft_MSKU1234567890.pdf" data-doc-status="VERIFIED">View</button></td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center gap-3">
                        <div class="doc-icon" style="width: 28px; height: 28px;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                          </svg>
                        </div>
                        <span style="font-weight: 500;">Export_Declaration.pdf</span>
                      </div>
                    </td>
                    <td><span class="badge badge-gray">EXPORT_DEC</span></td>
                    <td><a href="case-detail.html" style="color: var(--accent); text-decoration: none;">F1-SEA-2026-02448</a></td>
                    <td>BROKER</td>
                    <td><span class="badge badge-success">VERIFIED</span></td>
                    <td>–í—á–æ—Ä–∞, 14:55</td>
                    <td><button class="btn btn-sm btn-ghost" data-doc-view data-doc-name="Export_Declaration.pdf" data-doc-type="EXPORT_DEC" data-doc-source="BROKER" data-doc-case="F1-SEA-2026-02448" data-doc-confidence="96" data-doc-file="Export_Declaration.pdf" data-doc-status="VERIFIED">View</button></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Document Types Reference -->
        <div class="card mt-6">
          <div class="card-header">
            <h4 class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
              </svg>
              –¢–∏–ø–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (F1_SEA_IMPORT)
              <span class="help-trigger" data-help="doc-types">?</span>
            </h4>
          </div>
          <div class="card-body">
            <div class="table-container">
              <table class="table">
                <thead>
                  <tr>
                    <th>doc_type</th>
                    <th>–û–ø–∏—Å</th>
                    <th>–î–∂–µ—Ä–µ–ª–æ</th>
                    <th>AI Extraction</th>
                    <th>Required State</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>CONTRACT</code></td>
                    <td>–ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑ –∫–ª—ñ—î–Ω—Ç–æ–º</td>
                    <td>CLIENT</td>
                    <td>Extract parties, amounts</td>
                    <td>CLIENT_INFO_COLLECTED</td>
                  </tr>
                  <tr>
                    <td><code>INVOICE</code></td>
                    <td>–Ü–Ω–≤–æ–π—Å –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞</td>
                    <td>CLIENT / ZED</td>
                    <td>Extract items, totals</td>
                    <td>CONFIRMED</td>
                  </tr>
                  <tr>
                    <td><code>PACKING_LIST</code></td>
                    <td>–ü–∞–∫—É–≤–∞–ª—å–Ω–∏–π –ª–∏—Å—Ç</td>
                    <td>CLIENT</td>
                    <td>Extract dims, weights</td>
                    <td>CLIENT_INFO_COLLECTED</td>
                  </tr>
                  <tr>
                    <td><code>BL_DRAFT</code></td>
                    <td>–î—Ä–∞—Ñ—Ç –∫–æ–Ω–æ—Å–∞–º–µ–Ω—Ç—É</td>
                    <td>ZED</td>
                    <td>Extract BL fields, compare with contract</td>
                    <td>BL_DRAFT_RECEIVED</td>
                  </tr>
                  <tr>
                    <td><code>POA</code></td>
                    <td>–î–æ–≤—ñ—Ä–µ–Ω—ñ—Å—Ç—å</td>
                    <td>CLIENT</td>
                    <td>Verify signatures, dates</td>
                    <td>PRE_ARRIVAL_TASKS</td>
                  </tr>
                  <tr>
                    <td><code>EXPORT_DEC</code></td>
                    <td>–ï–∫—Å–ø–æ—Ä—Ç–Ω–∞ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—è</td>
                    <td>BROKER</td>
                    <td>Limited extraction</td>
                    <td>Optional</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Document Workflow -->
        <div class="card mt-4">
          <div class="card-header">
            <h4 class="flex items-center gap-2">
              Document Flow: Upload ‚Üí Extract ‚Üí Verify
              <span class="help-trigger" data-help="doc-workflow">?</span>
            </h4>
          </div>
          <div class="card-body">
            <div class="flex items-center gap-4" style="flex-wrap: wrap;">
              <div style="flex: 1; min-width: 120px; text-align: center; padding: 14px; background: var(--info-bg); border-radius: var(--radius-lg);">
                <div style="font-size: 20px; margin-bottom: 6px;">üì§</div>
                <div style="font-weight: 600; color: var(--info-text);">UPLOADED</div>
                <div class="text-xs text-muted">Human uploads file</div>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
              <div style="flex: 1; min-width: 120px; text-align: center; padding: 14px; background: var(--warning-bg); border-radius: var(--radius-lg);">
                <div style="font-size: 20px; margin-bottom: 6px;">ü§ñ</div>
                <div style="font-weight: 600; color: var(--warning-text);">PROCESSING</div>
                <div class="text-xs text-muted">AI extracts data</div>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
              <div style="flex: 1; min-width: 120px; text-align: center; padding: 14px; background: var(--success-bg); border-radius: var(--radius-lg);">
                <div style="font-size: 20px; margin-bottom: 6px;">‚úÖ</div>
                <div style="font-weight: 600; color: var(--success-text);">VERIFIED</div>
                <div class="text-xs text-muted">Human confirms extraction</div>
              </div>
            </div>
            <p class="text-sm text-secondary mt-4" style="text-align: center;">
              –Ø–∫—â–æ AI confidence &lt; 85%, –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ—Ç—Ä–µ–±—É—î –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ª—é–¥–∏–Ω–æ—é
            </p>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- Document Viewer Modal -->
  <div id="docViewerModal" class="doc-viewer-modal" style="display: none;">
    <div class="doc-viewer-overlay" onclick="DocumentViewer.close()"></div>
    <div class="doc-viewer-content">
      <!-- Reject Reason Modal (nested) -->
      <div id="rejectReasonModal" class="reject-reason-modal" style="display: none;" onclick="if(event.target === this) DocumentViewer.cancelReject()">
        <div class="reject-reason-content" onclick="event.stopPropagation()">
          <h4>–í—ñ–¥—Ö–∏–ª–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</h4>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
            –í–∫–∞–∂—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ <strong id="rejectDocName"></strong>
          </p>
          <textarea id="rejectReasonInput" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ü–æ–º–∏–ª–∫–∞ –≤ –¥–∞–Ω–∏—Ö, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç, –¥—É–±–ª—ñ–∫–∞—Ç..." style="width: 100%; min-height: 80px; padding: 8px; border: 1px solid var(--divider); border-radius: var(--radius-sm); background: var(--bg-panel); color: var(--text); font-family: inherit; font-size: 13px; resize: vertical;"></textarea>
          <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px;">
            <button class="btn btn-secondary" onclick="DocumentViewer.cancelReject()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button class="btn btn-danger" onclick="DocumentViewer.confirmReject()">–í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
          </div>
        </div>
      </div>
      <!-- Edit Extracted Data Modal (nested) -->
      <div id="editExtractedModal" class="reject-reason-modal" style="display: none;" onclick="if(event.target === this) DocumentViewer.cancelEdit()">
        <div class="reject-reason-content" onclick="event.stopPropagation()" style="max-width: 600px;">
          <h4>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ –¥–∞–Ω—ñ</h4>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
            –í–∏–ø—Ä–∞–≤—Ç–µ –¥–∞–Ω—ñ, —è–∫—ñ AI –≤–∏—Ç—è–≥–Ω—É–≤ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ <strong id="editDocName"></strong>
          </p>
          <div id="editExtractedFields" style="max-height: 400px; overflow-y: auto; margin-bottom: 16px;">
            <!-- Editable fields will be inserted here -->
          </div>
          <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px;">
            <button class="btn btn-secondary" onclick="DocumentViewer.cancelEdit()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button class="btn btn-primary" onclick="DocumentViewer.saveEdited()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
          </div>
        </div>
      </div>
      <!-- Edit Extracted Data Modal (nested) -->
      <div id="editExtractedModal" class="reject-reason-modal" style="display: none;" onclick="if(event.target === this) DocumentViewer.cancelEdit()">
        <div class="reject-reason-content" onclick="event.stopPropagation()" style="max-width: 600px;">
          <h4>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ –¥–∞–Ω—ñ</h4>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
            –í–∏–ø—Ä–∞–≤—Ç–µ –¥–∞–Ω—ñ, —è–∫—ñ AI –≤–∏—Ç—è–≥–Ω—É–≤ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ <strong id="editDocName"></strong>
          </p>
          <div id="editExtractedFields" style="max-height: 400px; overflow-y: auto; margin-bottom: 16px;">
            <!-- Editable fields will be inserted here -->
          </div>
          <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px;">
            <button class="btn btn-secondary" onclick="DocumentViewer.cancelEdit()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button class="btn btn-primary" onclick="DocumentViewer.saveEdited()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
          </div>
        </div>
      </div>
      <div class="doc-viewer-header">
        <div class="doc-viewer-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          <span id="docViewerFileName"></span>
        </div>
        <button class="doc-viewer-close" onclick="DocumentViewer.close()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="doc-viewer-body">
        <div class="doc-viewer-meta">
          <div class="doc-viewer-meta-item">
            <span class="doc-viewer-meta-label">–¢–∏–ø:</span>
            <span class="doc-viewer-meta-value" id="docViewerType"></span>
          </div>
          <div class="doc-viewer-meta-item">
            <span class="doc-viewer-meta-label">–î–∂–µ—Ä–µ–ª–æ:</span>
            <span class="doc-viewer-meta-value" id="docViewerSource"></span>
          </div>
          <div class="doc-viewer-meta-item">
            <span class="doc-viewer-meta-label">–ö–µ–π—Å:</span>
            <a href="case-detail.html" class="doc-viewer-meta-value" id="docViewerCase" style="color: var(--accent); text-decoration: none;"></a>
          </div>
          <div class="doc-viewer-meta-item">
            <span class="doc-viewer-meta-label">AI Confidence:</span>
            <span class="doc-viewer-meta-value" id="docViewerConfidence"></span>
          </div>
        </div>
        <div class="doc-viewer-content-grid">
          <div class="doc-viewer-preview" id="docViewerPreview">
            <!-- Preview content will be inserted here -->
          </div>
          <div class="doc-viewer-extracted" id="docViewerExtracted">
            <div class="extracted-header">
              <h4>AI Extracted Data <span class="help-trigger" data-help="verification-workflow">?</span></h4>
              <span class="extracted-badge" id="extractedConfidenceBadge"></span>
            </div>
            <div class="extracted-fields" id="extractedFields">
              <!-- Extracted fields will be inserted here -->
            </div>
            <div class="extracted-actions">
              <label class="checkbox-label">
                <input type="checkbox" id="extractedDataCorrect">
                <span>–î–∞–Ω—ñ –∫–æ—Ä–µ–∫—Ç–Ω—ñ</span>
              </label>
              <button class="btn btn-sm btn-secondary" onclick="DocumentViewer.editExtracted()" id="editExtractedBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ
              </button>
            </div>
            <div class="extracted-comment" style="margin-top: 12px;">
              <label style="font-size: 12px; color: var(--text-muted); margin-bottom: 6px; display: block;">–ö–æ–º–µ–Ω—Ç–∞—Ä (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):</label>
              <textarea id="verificationComment" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –ø—Ä–æ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é..." style="width: 100%; min-height: 60px; padding: 8px; border: 1px solid var(--divider); border-radius: var(--radius-sm); background: var(--bg-panel); color: var(--text); font-family: inherit; font-size: 12px; resize: vertical;"></textarea>
            </div>
          </div>
        </div>
        <div class="doc-viewer-actions">
          <button class="btn btn-secondary" onclick="DocumentViewer.download()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            –°–∫–∞—á–∞—Ç–∏
          </button>
          <button class="btn btn-danger" style="background: transparent; border-color: var(--danger); color: var(--danger);" onclick="DocumentViewer.reject()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            –í—ñ–¥—Ö–∏–ª–∏—Ç–∏
          </button>
          <button class="btn btn-primary" onclick="DocumentViewer.verify()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 11 12 14 22 4"/>
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
            </svg>
            –í–µ—Ä–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* ===== Onboarding Tips System ===== */
    .tip {
      position: absolute;
      background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%);
      color: white;
      padding: 12px 16px;
      border-radius: var(--radius-lg);
      font-size: 12px;
      max-width: 280px;
      box-shadow: 0 8px 32px rgba(0, 120, 212, 0.3);
      z-index: 100;
      animation: tipPulse 0.4s ease-out, tipGlow 2s ease-in-out infinite;
    }

    @keyframes tipPulse {
      0% { opacity: 0; transform: scale(0.9) translateY(10px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }

    @keyframes tipGlow {
      0%, 100% { box-shadow: 0 8px 32px rgba(0, 120, 212, 0.3); }
      50% { box-shadow: 0 8px 40px rgba(0, 120, 212, 0.5); }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .tip.hiding { animation: tipHide 0.3s ease-in forwards; }
    @keyframes tipHide { to { opacity: 0; transform: scale(0.95) translateY(-10px); } }

    .tip-content { display: flex; gap: 10px; align-items: flex-start; }
    .tip-icon { flex-shrink: 0; width: 24px; height: 24px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .tip-icon svg { width: 14px; height: 14px; }
    .tip-text { flex: 1; }
    .tip-title { font-weight: 600; font-size: 13px; margin-bottom: 4px; }
    .tip-description { opacity: 0.9; line-height: 1.4; }

    .tip-close { position: absolute; top: 8px; right: 8px; background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
    .tip-close:hover { background: rgba(255, 255, 255, 0.35); }
    .tip-close svg { width: 12px; height: 12px; }

    .tip::before { content: ''; position: absolute; width: 12px; height: 12px; background: inherit; transform: rotate(45deg); }
    .tip.arrow-top::before { top: -6px; left: 24px; }
    .tip.arrow-bottom::before { bottom: -6px; left: 24px; }
    .tip.arrow-left::before { left: -6px; top: 16px; }
    .tip.arrow-right::before { right: -6px; top: 16px; }

    .tip-step { display: inline-flex; align-items: center; gap: 6px; font-size: 10px; opacity: 0.75; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.2); }
    .tip-step-dots { display: flex; gap: 4px; }
    .tip-step-dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255, 255, 255, 0.3); }
    .tip-step-dot.active { background: white; }

    .tip-actions { display: flex; gap: 8px; margin-top: 10px; }
    .tip-btn { padding: 6px 12px; border-radius: var(--radius-sm); font-size: 11px; font-weight: 500; cursor: pointer; border: none; transition: all 0.2s; }
    .tip-btn-primary { background: white; color: #005a9e; }
    .tip-btn-primary:hover { background: rgba(255, 255, 255, 0.9); }
    .tip-btn-secondary { background: rgba(255, 255, 255, 0.15); color: white; }
    .tip-btn-secondary:hover { background: rgba(255, 255, 255, 0.25); }

    .tips-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.3); z-index: 99; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .tips-overlay.active { opacity: 1; pointer-events: auto; }
    .tip-highlight { position: relative; z-index: 101; box-shadow: 0 0 0 4px rgba(0, 120, 212, 0.4); border-radius: var(--radius-md); }

    .show-tips-btn { position: fixed; bottom: 20px; right: 20px; background: var(--accent); color: white; border: none; padding: 10px 16px; border-radius: var(--radius-lg); font-size: 12px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: var(--shadow-md); transition: all 0.2s; z-index: 50; }
    .show-tips-btn:hover { background: var(--accent-hover); transform: translateY(-2px); box-shadow: var(--shadow-popup); }
    .show-tips-btn svg { width: 16px; height: 16px; }

    /* ===== Static Help Triggers ===== */
    .help-trigger { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: var(--bg-hover); border: 1px solid var(--divider); border-radius: 50%; color: var(--text-muted); font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-left: 6px; flex-shrink: 0; }
    .help-trigger:hover { background: var(--accent); border-color: var(--accent); color: white; transform: scale(1.1); }
    .help-trigger.active { background: var(--accent); border-color: var(--accent); color: white; }

    .help-popup { position: fixed; background: var(--bg-editor); border: 1px solid var(--divider); border-radius: var(--radius-lg); box-shadow: var(--shadow-popup); padding: 12px 14px; font-size: 12px; max-width: 450px; max-height: 80vh; overflow-y: auto; z-index: 2000; animation: helpPopupIn 0.2s ease; }
    @keyframes helpPopupIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
    .help-popup.closing { animation: helpPopupOut 0.15s ease forwards; }
    @keyframes helpPopupOut { to { opacity: 0; transform: translateY(-8px); } }

    .help-popup::before { content: ''; position: absolute; top: -6px; left: 20px; width: 10px; height: 10px; background: var(--bg-editor); border-left: 1px solid var(--divider); border-top: 1px solid var(--divider); transform: rotate(45deg); }
    .help-popup.arrow-bottom::before { top: auto; bottom: -6px; border-left: none; border-top: none; border-right: 1px solid var(--divider); border-bottom: 1px solid var(--divider); }

    .help-popup-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--divider); }
    .help-popup-icon { width: 24px; height: 24px; background: var(--accent-light); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; color: var(--accent); }
    .help-popup-icon svg { width: 14px; height: 14px; }
    .help-popup-title { font-weight: 600; color: var(--text); }
    .help-popup-content { color: var(--text-secondary); line-height: 1.6; }
    .help-popup-content p { margin: 8px 0; }
    .help-popup-content p:first-child { margin-top: 0; }
    .help-popup-content p:last-child { margin-bottom: 0; }
    .help-popup-content hr { margin: 12px 0; border: none; border-top: 1px solid var(--divider); }
    .help-popup-content ul { margin: 8px 0; padding-left: 20px; }
    .help-popup-content ol { margin: 8px 0; padding-left: 20px; }
    .help-popup-content li { margin-bottom: 6px; }
    .help-popup-content code { background: var(--bg-panel); padding: 2px 6px; border-radius: 3px; font-size: 11px; font-family: var(--font-mono); color: var(--accent); }
    .help-popup-content strong { color: var(--text); font-weight: 600; }

    /* Positioning */
    .stat-card { position: relative; }
    .stat-card .help-trigger { position: absolute; top: 12px; right: 12px; }
    .inbox-section-title .help-trigger { margin-left: 8px; }
    .card { position: relative; }

    /* ===== Document Viewer Modal ===== */
    .doc-viewer-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; }
    .doc-viewer-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
    .doc-viewer-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-editor); border: 1px solid var(--divider); border-radius: var(--radius-lg); box-shadow: var(--shadow-popup); width: 95%; max-width: 1400px; max-height: 95vh; display: flex; flex-direction: column; }
    .doc-viewer-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid var(--divider); }
    .doc-viewer-title { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 16px; color: var(--text); }
    .doc-viewer-title svg { color: var(--accent); }
    .doc-viewer-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; border-radius: var(--radius-sm); transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
    .doc-viewer-close:hover { background: var(--bg-hover); color: var(--text); }
    .doc-viewer-body { padding: 20px; overflow-y: auto; flex: 1; }
    .doc-viewer-meta { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--divider); }
    .doc-viewer-meta-item { display: flex; flex-direction: column; gap: 4px; }
    .doc-viewer-meta-label { font-size: 12px; color: var(--text-muted); font-weight: 500; }
    .doc-viewer-meta-value { font-size: 14px; color: var(--text); }
    .doc-viewer-content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    @media (max-width: 900px) {
      .doc-viewer-content-grid { grid-template-columns: 1fr; }
    }
    .doc-viewer-preview { background: var(--bg-panel); border: 1px solid var(--divider); border-radius: var(--radius-md); padding: 20px; min-height: 400px; max-height: 600px; overflow-y: auto; }
    .doc-viewer-extracted { background: var(--bg-panel); border: 1px solid var(--divider); border-radius: var(--radius-md); padding: 16px; }
    .extracted-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider); }
    .extracted-header h4 { margin: 0; font-size: 14px; font-weight: 600; color: var(--text); }
    .extracted-badge { font-size: 11px; padding: 2px 8px; border-radius: var(--radius-sm); background: var(--bg-hover); color: var(--text-secondary); }
    .extracted-badge.high { background: var(--success-bg); color: var(--success-text); }
    .extracted-badge.medium { background: var(--warning-bg); color: var(--warning-text); }
    .extracted-badge.low { background: var(--danger-bg); color: var(--danger-text); }
    .extracted-fields { margin-bottom: 16px; max-height: 400px; overflow-y: auto; }
    .extracted-field { display: flex; flex-direction: column; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--divider); }
    .extracted-field:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .extracted-field-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
    .extracted-field-value { font-size: 13px; color: var(--text); font-weight: 500; }
    .extracted-actions { display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid var(--divider); }
    .checkbox-label { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); cursor: pointer; }
    .checkbox-label input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; }
    .doc-viewer-preview table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .doc-viewer-preview table th, .doc-viewer-preview table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--divider); }
    .doc-viewer-preview table th { background: var(--bg-hover); font-weight: 600; color: var(--text); }
    .doc-viewer-preview table td { color: var(--text-secondary); }
    .doc-viewer-preview .preview-info { text-align: center; padding: 40px; color: var(--text-muted); }
    .doc-viewer-preview .preview-info svg { width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.5; }
    .doc-viewer-actions { display: flex; gap: 12px; justify-content: flex-end; padding-top: 20px; border-top: 1px solid var(--divider); }
    .doc-viewer-actions .btn { display: flex; align-items: center; gap: 6px; }

    /* ===== Reject Reason Modal ===== */
    .reject-reason-modal { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1001; border-radius: var(--radius-lg); }
    .reject-reason-content { background: var(--bg-editor); border: 1px solid var(--divider); border-radius: var(--radius-lg); padding: 20px; max-width: 500px; width: 90%; box-shadow: var(--shadow-popup); }
    .reject-reason-content h4 { margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: var(--text); }
    .reject-reason-content textarea:focus { outline: none; border-color: var(--danger); }

    /* ===== Upload Modal ===== */
    .upload-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; }
    .upload-modal-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
    .upload-modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-editor); border: 1px solid var(--divider); border-radius: var(--radius-lg); box-shadow: var(--shadow-popup); width: 90%; max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; }
    .upload-modal-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--divider); }
    .upload-modal-header h3 { margin: 0; font-size: 18px; font-weight: 600; color: var(--text); }
    .upload-modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-sm); transition: all 0.2s; }
    .upload-modal-close:hover { background: var(--bg-hover); color: var(--text); }
    .upload-modal-body { padding: 24px; overflow-y: auto; flex: 1; }
    .upload-modal-actions { display: flex; gap: 12px; justify-content: flex-end; padding: 16px 24px; border-top: 1px solid var(--divider); }
    .upload-modal-actions .btn { display: flex; align-items: center; gap: 6px; }

    /* Upload Drop Zone */
    .upload-drop-zone { border: 2px dashed var(--divider); border-radius: var(--radius-md); padding: 40px 20px; text-align: center; cursor: pointer; transition: all 0.2s; background: var(--bg-panel); }
    .upload-drop-zone:hover { border-color: var(--accent); background: var(--bg-hover); }
    .upload-drop-zone.drag-over { border-color: var(--accent); background: var(--accent-bg); }
    .upload-drop-content { pointer-events: none; }

    /* Upload Fields */
    .upload-field { margin-top: 20px; }
    .upload-select { width: 100%; padding: 10px 12px; border: 1px solid var(--divider); border-radius: var(--radius-sm); background: var(--bg-panel); color: var(--text); font-family: inherit; font-size: 13px; cursor: pointer; transition: border-color 0.2s; }
    .upload-select:focus { outline: none; border-color: var(--accent); }
    .upload-select:hover { border-color: var(--accent); }

    /* Upload Files Preview */
    .upload-files-preview { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--divider); }
    .upload-files-list { display: flex; flex-direction: column; gap: 8px; }
    .upload-file-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: var(--bg-panel); border: 1px solid var(--divider); border-radius: var(--radius-sm); }
    .upload-file-info { display: flex; align-items: center; gap: 10px; flex: 1; }
    .upload-file-icon { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: var(--accent-bg); border-radius: var(--radius-sm); color: var(--accent); }
    .upload-file-details { flex: 1; }
    .upload-file-name { font-size: 13px; font-weight: 500; color: var(--text); margin-bottom: 2px; }
    .upload-file-size { font-size: 11px; color: var(--text-muted); }
    .upload-file-remove { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-sm); transition: all 0.2s; }
    .upload-file-remove:hover { background: var(--bg-hover); color: var(--danger); }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>

  <script>
    // ===== ONBOARDING TIPS SYSTEM =====
    const TipsManager = {
      storageKey: 'imcp_documents_tips',
      tips: [],
      currentStep: 0,
      tourMode: false,

      init() {
        console.log('[TipsManager] init started');
        this.loadState();
        console.log('[TipsManager] dismissedTips:', this.dismissedTips);
        this.createTips();
        console.log('[TipsManager] tips created:', this.tips.length);
        this.createShowTipsButton();
        console.log('[TipsManager] button created');
        setTimeout(() => { 
          console.log('[TipsManager] checking if all dismissed:', this.allTipsDismissed());
          if (!this.allTipsDismissed()) this.showInitialTips(); 
        }, 500);
      },

      loadState() {
        try { const saved = localStorage.getItem(this.storageKey); this.dismissedTips = saved ? JSON.parse(saved) : {}; }
        catch (e) { this.dismissedTips = {}; }
      },

      saveState() { try { localStorage.setItem(this.storageKey, JSON.stringify(this.dismissedTips)); } catch (e) {} },

      allTipsDismissed() { return this.tips.every(tip => this.dismissedTips[tip.id]); },

      createTips() {
        this.tips = [
          { id: 'tip-verification', targetSelector: '.inbox-section', title: '–î–æ–∫—É–º–µ–Ω—Ç–∏ –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó', description: 'AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î –¥–æ–∫—É–º–µ–Ω—Ç–∏. –Ø–∫—â–æ confidence < 85%, –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—é–¥–∏–Ω–æ—é.', position: 'inside-top', arrow: 'none', icon: 'check' },
          { id: 'tip-stats', targetSelector: '.stats-grid', title: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤', description: '–®–≤–∏–¥–∫–∏–π –æ–≥–ª—è–¥: —Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä–µ–±—É—î –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Å—å–æ–≥–æ–¥–Ω—ñ, AI extraction rate.', position: 'bottom-left', arrow: 'top', icon: 'chart' },
          { id: 'tip-workflow', targetSelector: '.card.mt-4', title: 'Document Workflow', description: '–¢—Ä–∏ –µ—Ç–∞–ø–∏ –æ–±—Ä–æ–±–∫–∏: Upload ‚Üí AI Processing ‚Üí Human Verification.', position: 'inside-top', arrow: 'none', icon: 'flow' },
          { id: 'tip-types', targetSelector: '.card.mt-6 .card-header', title: '–¢–∏–ø–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤', description: '–ö–æ–∂–µ–Ω —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –º–∞—î —Å–≤–æ—ó –ø—Ä–∞–≤–∏–ª–∞ AI extraction —Ç–∞ required state.', position: 'bottom-left', arrow: 'top', icon: 'file' }
        ];
      },

      createShowTipsButton() {
        const btn = document.createElement('button');
        btn.className = 'show-tips-btn';
        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>–ü—ñ–¥–∫–∞–∑–∫–∏`;
        btn.onclick = () => this.startTour();
        document.body.appendChild(btn);
      },

      showInitialTips() {
        const firstActiveTip = this.tips.find(tip => !this.dismissedTips[tip.id]);
        if (firstActiveTip) this.showTip(firstActiveTip, false);
      },

      showTip(tipConfig, isTour = false) {
        console.log('[TipsManager] showTip called:', tipConfig.id, 'selector:', tipConfig.targetSelector);
        const target = document.querySelector(tipConfig.targetSelector);
        if (!target) {
          console.error('[TipsManager] Target NOT FOUND for:', tipConfig.targetSelector);
          return;
        }
        console.log('[TipsManager] Target found:', target);

        // –í–∏–¥–∞–ª—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ tips
        this.hideAllTips();

        const tip = document.createElement('div');
        tip.className = `tip arrow-${tipConfig.arrow}`;
        tip.id = tipConfig.id;
        tip.dataset.tipId = tipConfig.id;

        const iconSvg = this.getIcon(tipConfig.icon);
        const stepIndicator = isTour ? this.getStepIndicator() : '';

        tip.innerHTML = `
          <button class="tip-close" onclick="TipsManager.dismissTip('${tipConfig.id}')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
          <div class="tip-content">
            <div class="tip-icon">${iconSvg}</div>
            <div class="tip-text">
              <div class="tip-title">${tipConfig.title}</div>
              <div class="tip-description">${tipConfig.description}</div>
              ${isTour ? `
                <div class="tip-actions">
                  ${this.currentStep > 0 ? '<button class="tip-btn tip-btn-secondary" onclick="TipsManager.prevStep()">‚Üê –ù–∞–∑–∞–¥</button>' : ''}
                  ${this.currentStep < this.tips.length - 1 
                    ? '<button class="tip-btn tip-btn-primary" onclick="TipsManager.nextStep()">–î–∞–ª—ñ ‚Üí</button>'
                    : '<button class="tip-btn tip-btn-primary" onclick="TipsManager.endTour()">–ì–æ—Ç–æ–≤–æ ‚úì</button>'}
            </div>
              ` : ''}
              ${stepIndicator}
            </div>
          </div>
        `;

        document.body.appendChild(tip);

        // –ü–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è
        this.positionTip(tip, target, tipConfig.position);

        // –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ target –µ–ª–µ–º–µ–Ω—Ç–∞ –≤ tour mode
        if (isTour) {
          target.classList.add('tip-highlight');
        }
      },

      positionTip(tip, target, position) {
        const targetRect = target.getBoundingClientRect();
        const tipRect = tip.getBoundingClientRect();
        
        let top, left;

        switch (position) {
          case 'bottom-right':
            top = targetRect.bottom + 12;
            left = targetRect.right - tipRect.width;
            break;
          case 'bottom-left':
            top = targetRect.bottom + 12;
            left = targetRect.left;
            break;
          case 'inside-top':
            top = targetRect.top + 60;
            left = targetRect.left + 20;
            break;
          default:
            top = targetRect.bottom + 12;
            left = targetRect.left;
        }

        // –ü–µ—Ä–µ–∫–æ–Ω—É—î–º–æ—Å—å, —â–æ tip –≤ –º–µ–∂–∞—Ö –µ–∫—Ä–∞–Ω—É
        const padding = 16;
        left = Math.max(padding, Math.min(left, window.innerWidth - tipRect.width - padding));
        top = Math.max(padding, Math.min(top, window.innerHeight - tipRect.height - padding));

        tip.style.position = 'fixed';
        tip.style.top = `${top}px`;
        tip.style.left = `${left}px`;
      },

      getIcon(iconName) {
        const icons = {
          check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>',
          chart: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>',
          flow: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>',
          file: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>'
        };
        return icons[iconName] || icons.file;
      },

      getStepIndicator() {
        const dots = this.tips.map((_, i) => `<span class="tip-step-dot ${i === this.currentStep ? 'active' : ''}"></span>`).join('');
        return `<div class="tip-step"><div class="tip-step-dots">${dots}</div><span>${this.currentStep + 1} –∑ ${this.tips.length}</span></div>`;
      },

      dismissTip(tipId) {
        const tip = document.querySelector(`[data-tip-id="${tipId}"]`);
        if (tip) { tip.classList.add('hiding'); setTimeout(() => tip.remove(), 300); }
        this.dismissedTips[tipId] = true;
        this.saveState();
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
        if (this.tourMode) this.endTour();
      },

      hideAllTips() {
        document.querySelectorAll('.tip').forEach(tip => tip.remove());
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
      },

      startTour() {
        console.log('[TipsManager] startTour called');
        this.tourMode = true;
        this.currentStep = 0;
        
        // –°—Ç–≤–æ—Ä—é—î–º–æ overlay
        let overlay = document.querySelector('.tips-overlay');
        if (!overlay) {
          overlay = document.createElement('div');
          overlay.className = 'tips-overlay';
          overlay.onclick = () => this.endTour();
          document.body.appendChild(overlay);
          console.log('[TipsManager] overlay created');
        }
        overlay.classList.add('active');
        console.log('[TipsManager] overlay activated');

        this.showCurrentTourStep();
      },

      showCurrentTourStep() {
        if (this.currentStep >= 0 && this.currentStep < this.tips.length) {
          this.showTip(this.tips[this.currentStep], true);
          const target = document.querySelector(this.tips[this.currentStep].targetSelector);
          if (target) target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      },

      nextStep() {
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
        this.currentStep++;
        if (this.currentStep < this.tips.length) this.showCurrentTourStep(); else this.endTour();
      },

      prevStep() {
        document.querySelectorAll('.tip-highlight').forEach(el => el.classList.remove('tip-highlight'));
        if (this.currentStep > 0) { this.currentStep--; this.showCurrentTourStep(); }
      },

      endTour() {
        this.tourMode = false;
        this.hideAllTips();
        const overlay = document.querySelector('.tips-overlay');
        if (overlay) overlay.classList.remove('active');
      },

      resetAllTips() { this.dismissedTips = {}; this.saveState(); this.showInitialTips(); }
    };

    // ===== STATIC HELP SYSTEM =====
    const HelpManager = {
      activePopup: null,
      activeTrigger: null,

      helpContent: {
        'documents-page': {
          title: '–°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤',
          icon: 'file',
          content: `<p>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –≤—Å—ñ—Ö –∫–µ–π—Å—ñ–≤.</p><ul><li>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</li><li>AI extraction —Ç–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è</li><li>–ü–æ—à—É–∫ –ø–æ –≤—Å—ñ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö</li></ul>`
        },
        'needs-verification': {
          title: '–ü–æ—Ç—Ä–µ–±—É—é—Ç—å –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó',
          icon: 'check',
          content: `<p>–î–æ–∫—É–º–µ–Ω—Ç–∏, –¥–µ AI extraction –ø–æ—Ç—Ä–µ–±—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ª—é–¥–∏–Ω–∏.</p><p><strong>–ü—Ä–∏—á–∏–Ω–∏:</strong></p><ul><li>Confidence < 85%</li><li>–ù–æ–≤—ñ —Ç–∏–ø–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</li><li>–í–∏—è–≤–ª–µ–Ω—ñ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ</li></ul>`
        },
        'ai-confidence': {
          title: 'AI Confidence',
          icon: 'ai',
          content: `<p><strong>–†—ñ–≤–µ–Ω—å –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ AI</strong> –ø–æ–∫–∞–∑—É—î, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –≤–ø–µ–≤–Ω–µ–Ω–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –≤–∏—Ç—è–≥–Ω—É—Ç–∏—Ö –¥–∞–Ω–∏—Ö –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞.</p>
            <p><strong>–ü–æ—Ä–æ–≥–∏ confidence:</strong></p>
            <ul>
              <li>üü¢ <strong>‚â•95%</strong> ‚Äî –≤–∏—Å–æ–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å, –º–æ–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ verified (Quick Verify –¥–æ—Å—Ç—É–ø–Ω–∏–π)</li>
              <li>üü° <strong>85-94%</strong> ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ (NEEDS VERIFICATION)</li>
              <li>üî¥ <strong>&lt;85%</strong> ‚Äî –Ω–∏–∑—å–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å, –æ–±–æ–≤'—è–∑–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—é–¥–∏–Ω–æ—é (LOW CONFIDENCE)</li>
            </ul>
            <p><strong>–©–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ confidence:</strong></p>
            <ul>
              <li>–Ø–∫—ñ—Å—Ç—å —Å–∫–∞–Ω—É/–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞</li>
              <li>–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç—É (—Ä—É–∫–æ–ø–∏—Å, —Ç–∞–±–ª–∏—Ü—ñ, —Å–∫–ª–∞–¥–Ω—ñ –º–∞–∫–µ—Ç–∏)</li>
              <li>–ó–Ω–∞–π–æ–º—ñ—Å—Ç—å –∑ —Ç–∏–ø–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–Ω–æ–≤—ñ —Ç–∏–ø–∏ –º–∞—é—Ç—å –Ω–∏–∂—á–∏–π confidence)</li>
              <li>–†–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –∑ —ñ–Ω—à–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∫–µ–π—Å—É</li>
              <li>–ü–æ–≤–Ω–æ—Ç–∞ —Ç–∞ —á—ñ—Ç–∫—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö —É –¥–æ–∫—É–º–µ–Ω—Ç—ñ</li>
            </ul>
            <p><strong>–©–æ —Ä–æ–±–∏—Ç–∏:</strong></p>
            <ul>
              <li>–í–∏—Å–æ–∫–∏–π confidence (‚â•95%) ‚Äî –º–æ–∂–Ω–∞ —à–≤–∏–¥–∫–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</li>
              <li>–°–µ—Ä–µ–¥–Ω—ñ–π confidence (85-94%) ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ –¥–∞–Ω—ñ –ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º</li>
              <li>–ù–∏–∑—å–∫–∏–π confidence (&lt;85%) ‚Äî –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤—Å—ñ –ø–æ–ª—è, –º–æ–∂–ª–∏–≤–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</li>
            </ul>
            <hr style="border: none; border-top: 1px solid var(--divider); margin: 16px 0;">
            <p><strong>üì• –ü–æ—Ö–æ–¥–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É:</strong></p>
            <p>–î–æ–∫—É–º–µ–Ω—Ç–∏ –º–æ–∂—É—Ç—å –∑'—è–≤–∏—Ç–∏—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ –∑ —Ä—ñ–∑–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª:</p>
            <ul>
              <li><strong>CLIENT</strong> ‚Äî –∫–ª—ñ—î–Ω—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —á–µ—Ä–µ–∑ UI –∞–±–æ –Ω–∞–¥—Å–∏–ª–∞—î email (–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏, Packing List, POA)</li>
              <li><strong>ZED</strong> ‚Äî –≤—ñ–¥–¥—ñ–ª –∑–æ–≤–Ω—ñ—à–Ω—å–æ–µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ—ó –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ (BL Draft, —ñ–Ω–≤–æ–π—Å–∏ –≤—ñ–¥ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤)</li>
              <li><strong>BROKER</strong> ‚Äî –º–∏—Ç–Ω–∏–π –±—Ä–æ–∫–µ—Ä (Export Declaration, –º–∏—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏)</li>
              <li><strong>WAREHOUSE</strong> ‚Äî —Å–∫–ª–∞–¥ —á–µ—Ä–µ–∑ webhook (—Ñ–∞–∫—Ç–∏—á–Ω—ñ –≥–∞–±–∞—Ä–∏—Ç–∏, –≤–∞–≥–∞)</li>
            </ul>
            <p><strong>–ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞:</strong></p>
            <ol style="margin-left: 20px; padding-left: 0;">
              <li>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ‚Üí —Å—Ç–∞—Ç—É—Å <code>UPLOADED</code></li>
              <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–±—Ä–æ–±–∫–∞ AI ‚Üí —Å—Ç–∞—Ç—É—Å <code>PROCESSING</code></li>
              <li>AI –≤–∏—Ç—è–≥—É—î –¥–∞–Ω—ñ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î confidence</li>
              <li>–Ø–∫—â–æ confidence &lt;95% ‚Üí —Å—Ç–∞—Ç—É—Å <code>NEEDS_VERIFICATION</code></li>
              <li>–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–∞ –≤–µ—Ä–∏—Ñ—ñ–∫—É—î ‚Üí —Å—Ç–∞—Ç—É—Å <code>VERIFIED</code></li>
            </ol>
            <hr style="border: none; border-top: 1px solid var(--divider); margin: 16px 0;">
            <p><strong>‚ö° –í–ø–ª–∏–≤ –Ω–∞ –∫–µ–π—Å:</strong></p>
            <p>–ü—ñ—Å–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–æ–∫—É–º–µ–Ω—Ç–∞:</p>
            <ul>
              <li><strong>–î–∞–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è</strong> –≤ <code>cases.payload</code> (—Ä–æ–∑–º—ñ—Ä–∏, –≤–∞–≥–∞, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å —Ç–æ—â–æ)</li>
              <li><strong>–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø–æ–¥—ñ—è</strong> <code>DOC_VERIFIED</code> –≤ timeline –∫–µ–π—Å—É</li>
              <li><strong>n8n workflow –ø–µ—Ä–µ–≤—ñ—Ä—è—î</strong> —á–∏ –≤—Å—ñ required –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≥–æ—Ç–æ–≤—ñ</li>
              <li><strong>–Ø–∫—â–æ –≤—Å—ñ required fields –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ</strong> ‚Üí –º–æ–∂–ª–∏–≤–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –∫–µ–π—Å—É</li>
              <li><strong>–Ø–∫—â–æ –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –≤–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π</strong> ‚Üí –∫–µ–π—Å –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π (<code>BLOCKED</code> status) –¥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö</li>
              <li><strong>–î–æ–¥–∞—é—Ç—å—Å—è risk flags</strong> —è–∫—â–æ —î —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –∑ —ñ–Ω—à–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, <code>DIMS_MISMATCH</code>)</li>
            </ul>
            <p><em>üí° –ü—Ä–∏–∫–ª–∞–¥:</em> –ü—ñ—Å–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó Packing List –¥–∞–Ω—ñ –ø—Ä–æ –≥–∞–±–∞—Ä–∏—Ç–∏ —Ç–∞ –≤–∞–≥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –≤ –∫–µ–π—Å—ñ, —ñ —è–∫—â–æ —Ü–µ –±—É–≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π required –¥–æ–∫—É–º–µ–Ω—Ç, –∫–µ–π—Å –º–æ–∂–µ –ø–µ—Ä–µ–π—Ç–∏ –∑—ñ —Å—Ç–∞–Ω—É <code>WAITING_WAREHOUSE_DIMS</code> –¥–æ <code>DIMS_CONFIRMED</code>.</p>`
        },
        'verification-workflow': {
          title: '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è AI Extracted Data',
          icon: 'edit',
          content: `<p>–ü—ñ–¥ —á–∞—Å –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, —è–∫—â–æ AI –ø–æ–º–∏–ª–∏–≤—Å—è:</p>
            <ul>
              <li><strong>AI extracted data</strong> ‚Äî —Ü–µ —Ç–µ, —â–æ AI –≤–∏—Ç—è–≥–Ω—É–≤ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (readonly)</li>
              <li><strong>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –º–æ–∂–Ω–∞</strong> —Ñ—ñ–Ω–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫—ñ –ø—ñ–¥—É—Ç—å —É <code>cases.payload</code></li>
              <li><strong>AI –º–æ–∂–µ –ø–æ–º–∏–ª—è—Ç–∏—Å—è</strong> –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ –Ω–∏–∑—å–∫–æ–º—É confidence (&lt;85%)</li>
            </ul>
            <hr style="border: none; border-top: 1px solid var(--divider); margin: 12px 0;">
            <p><strong>Workflow –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:</strong></p>
            <ol style="margin-left: 20px; padding-left: 0;">
              <li>–ú–µ–Ω–µ–¥–∂–µ—Ä –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ–∫—É–º–µ–Ω—Ç (<strong>View</strong>)</li>
              <li>–ë–∞—á–∏—Ç—å: Document Preview + AI Extracted Data (side-by-side)</li>
              <li>–í–∞—Ä—ñ–∞–Ω—Ç–∏ –¥—ñ–π:
                <ul style="margin-top: 4px;">
                  <li>‚úÖ <strong>–î–∞–Ω—ñ –∫–æ—Ä–µ–∫—Ç–Ω—ñ</strong> ‚Üí –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ ‚Üí –¥–∞–Ω—ñ –∫–æ–ø—ñ—é—é—Ç—å—Å—è –≤ payload</li>
                  <li>‚úèÔ∏è <strong>–Ñ –ø–æ–º–∏–ª–∫–∏</strong> ‚Üí –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ ‚Üí –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</li>
                  <li>‚ùå <strong>–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ–ø—Ä–∏–¥–∞—Ç–Ω–∏–π</strong> ‚Üí –í—ñ–¥—Ö–∏–ª–∏—Ç–∏ ‚Üí –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–æ–≤–∏–π –¥–æ–∫—É–º–µ–Ω—Ç</li>
                </ul>
              </li>
            </ol>
            <hr style="border: none; border-top: 1px solid var(--divider); margin: 12px 0;">
            <p><em>‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ:</em> –ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ —Ä–µ–¥–∞–≥—É—î —Å–∞–º AI extraction ‚Äî –≤—ñ–Ω —Ä–µ–¥–∞–≥—É—î <strong>—Ñ—ñ–Ω–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è</strong>, —è–∫—ñ –ø—ñ–¥—É—Ç—å —É –∫–µ–π—Å. AI extraction –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —è–∫ —î –¥–ª—è –∞—É–¥–∏—Ç—É.</p>`
        },
        'doc-sources': {
          title: '–î–∂–µ—Ä–µ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤',
          icon: 'source',
          content: `<p>–ó–≤—ñ–¥–∫–∏ –Ω–∞–¥—ñ–π—à–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç:</p><ul><li><strong>CLIENT</strong> ‚Äî –≤—ñ–¥ –∫–ª—ñ—î–Ω—Ç–∞</li><li><strong>ZED</strong> ‚Äî –≤—ñ–¥ –ó–ï–î</li><li><strong>BROKER</strong> ‚Äî –≤—ñ–¥ –º–∏—Ç–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞</li><li><strong>WAREHOUSE</strong> ‚Äî –≤—ñ–¥ —Å–∫–ª–∞–¥—É</li></ul>`
        },
        'doc-statuses': {
          title: '–°—Ç–∞—Ç—É—Å–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤',
          icon: 'status',
          content: `<p>–ï—Ç–∞–ø–∏ –æ–±—Ä–æ–±–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:</p><ul><li>üì§ <strong>UPLOADED</strong> ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ</li><li>‚öôÔ∏è <strong>PROCESSING</strong> ‚Äî AI –æ–±—Ä–æ–±–ª—è—î</li><li>‚ö†Ô∏è <strong>NEEDS VERIFICATION</strong> ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞</li><li>‚úÖ <strong>VERIFIED</strong> ‚Äî –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</li></ul>`
        },
        'doc-types': {
          title: '–¢–∏–ø–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤',
          icon: 'file',
          content: `<p>–ö–æ–∂–µ–Ω —Ç–∏–ø –º–∞—î —Å–≤–æ—ó –ø—Ä–∞–≤–∏–ª–∞:</p><ul><li><code>CONTRACT</code> ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç</li><li><code>INVOICE</code> ‚Äî —ñ–Ω–≤–æ–π—Å</li><li><code>PACKING_LIST</code> ‚Äî –ø–∞–∫—É–≤–∞–ª—å–Ω–∏–π –ª–∏—Å—Ç</li><li><code>BL_DRAFT</code> ‚Äî –∫–æ–Ω–æ—Å–∞–º–µ–Ω—Ç</li><li><code>POA</code> ‚Äî –¥–æ–≤—ñ—Ä–µ–Ω—ñ—Å—Ç—å</li></ul>`
        },
        'doc-workflow': {
          title: 'Document Workflow',
          icon: 'flow',
          content: `<p>–ü—Ä–æ—Ü–µ—Å –æ–±—Ä–æ–±–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:</p><ol><li><strong>Upload</strong> ‚Äî –ª—é–¥–∏–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î</li><li><strong>Processing</strong> ‚Äî AI –≤–∏—Ç—è–≥—É—î –¥–∞–Ω—ñ</li><li><strong>Verification</strong> ‚Äî –ª—é–¥–∏–Ω–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î</li></ol><p>–ü—ñ—Å–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –≤ –∫–µ–π—Å—ñ.</p>`
        },
        'extraction-rate': {
          title: 'AI Extraction Rate',
          icon: 'ai',
          content: `<p>–°–µ—Ä–µ–¥–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ AI –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤.</p><p>89% –æ–∑–Ω–∞—á–∞—î, —â–æ –≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É AI –≤–ø–µ–≤–Ω–µ–Ω–∏–π –Ω–∞ 89% —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ –≤–∏—Ç—è–≥–Ω—É—Ç–∏—Ö –¥–∞–Ω–∏—Ö.</p>`
        }
      },

      init() { this.bindEvents(); },

      bindEvents() {
        document.addEventListener('click', (e) => {
          const trigger = e.target.closest('.help-trigger');
          if (trigger) { e.preventDefault(); e.stopPropagation(); const helpId = trigger.dataset.help; if (helpId) this.togglePopup(helpId, trigger); return; }
          if (this.activePopup && !e.target.closest('.help-popup')) this.closePopup();
        });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && this.activePopup) this.closePopup(); });
      },

      togglePopup(helpId, trigger) {
        if (this.activeTrigger === trigger) { this.closePopup(); return; }
        this.closePopup();

        const content = this.helpContent[helpId];
        if (!content) return;

        const popup = document.createElement('div');
        popup.className = 'help-popup';
        popup.innerHTML = `<div class="help-popup-header"><div class="help-popup-icon">${this.getIcon(content.icon)}</div><div class="help-popup-title">${content.title}</div></div><div class="help-popup-content">${content.content}</div>`;

        document.body.appendChild(popup);
        this.positionPopup(popup, trigger);

        this.activePopup = popup;
        this.activeTrigger = trigger;
        trigger.classList.add('active');
      },

      positionPopup(popup, trigger) {
        const triggerRect = trigger.getBoundingClientRect();
        
        // First, append to body to measure
        popup.style.visibility = 'hidden';
        popup.style.position = 'fixed';
        document.body.appendChild(popup);
        const popupRect = popup.getBoundingClientRect();
        popup.style.visibility = 'visible';

        let top = triggerRect.bottom + 8;
        let left = triggerRect.left - 10;

        // Adjust horizontal position
        if (left + popupRect.width > window.innerWidth - 16) {
          left = window.innerWidth - popupRect.width - 16;
        }
        left = Math.max(16, left);

        // Adjust vertical position - prefer showing below, but flip if needed
        const spaceBelow = window.innerHeight - triggerRect.bottom - 16;
        const spaceAbove = triggerRect.top - 16;
        
        if (popupRect.height > spaceBelow && spaceAbove > spaceBelow) {
          // Show above trigger
          top = triggerRect.top - popupRect.height - 8;
          popup.classList.add('arrow-bottom');
        } else {
          // Show below trigger, but ensure it fits
          if (top + popupRect.height > window.innerHeight - 16) {
            top = Math.max(16, window.innerHeight - popupRect.height - 16);
          }
        }

        popup.style.top = `${top}px`;
        popup.style.left = `${left}px`;
      },

      closePopup() {
        if (this.activePopup) { this.activePopup.classList.add('closing'); setTimeout(() => { if (this.activePopup) { this.activePopup.remove(); this.activePopup = null; } }, 150); }
        if (this.activeTrigger) { this.activeTrigger.classList.remove('active'); this.activeTrigger = null; }
      },

      getIcon(iconName) {
        const icons = {
          file: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>',
          check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>',
          ai: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/></svg>',
          source: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',
          status: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
          flow: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>',
          edit: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>'
        };
        return icons[iconName] || icons.file;
      }
    };

    // ===== DOCUMENT TYPE SCHEMAS =====
    // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø–æ–ª—ñ–≤ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
    // –í production —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ API –∞–±–æ —Ç–∞–±–ª–∏—Ü—ñ doc_type_configs
    const DOC_TYPE_SCHEMAS = {
      // Packing List ‚Äî –ø–∞–∫—É–≤–∞–ª—å–Ω–∏–π –ª–∏—Å—Ç
      PACKING_LIST: {
        name: 'Packing List',
        fields: [
          { key: 'packages_count', label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å', type: 'number', required: true, payloadPath: 'payload.cargo.packages_count' },
          { key: 'total_weight_kg', label: '–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞–≥–∞ (–∫–≥)', type: 'number', required: true, payloadPath: 'payload.cargo.total_weight_kg' },
          { key: 'volume_cbm', label: "–ó–∞–≥–∞–ª—å–Ω–∏–π –æ–±'—î–º (CBM)", type: 'number', required: false, payloadPath: 'payload.cargo.volume_cbm' },
          { key: 'dimensions', label: '–†–æ–∑–º—ñ—Ä–∏ (L√óW√óH —Å–º)', type: 'text', required: true, payloadPath: 'payload.cargo.dimensions' },
          { key: 'package_type', label: '–¢–∏–ø —É–ø–∞–∫–æ–≤–∫–∏', type: 'text', required: false, payloadPath: 'payload.cargo.package_type' }
        ],
        // Demo mock values (–≤ production —Ü–µ –ø—Ä–∏–π–¥–µ –∑ AI extraction)
        mockValues: {
          packages_count: '10',
          total_weight_kg: '255',
          volume_cbm: '0.222',
          dimensions: '60√ó40√ó50',
          package_type: '–ö–∞—Ä—Ç–æ–Ω–Ω—ñ –∫–æ—Ä–æ–±–∫–∏'
        }
      },

      // Invoice ‚Äî —ñ–Ω–≤–æ–π—Å
      INVOICE: {
        name: 'Invoice',
        fields: [
          { key: 'invoice_number', label: '–ù–æ–º–µ—Ä —ñ–Ω–≤–æ–π—Å—É', type: 'text', required: true, payloadPath: 'payload.invoice.number' },
          { key: 'invoice_date', label: '–î–∞—Ç–∞', type: 'date', required: true, payloadPath: 'payload.invoice.date' },
          { key: 'amount', label: '–°—É–º–∞', type: 'currency', required: true, payloadPath: 'payload.invoice.amount' },
          { key: 'currency', label: '–í–∞–ª—é—Ç–∞', type: 'select', options: ['USD', 'EUR', 'CNY', 'UAH'], required: true, payloadPath: 'payload.invoice.currency' },
          { key: 'supplier', label: '–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫', type: 'text', required: true, payloadPath: 'payload.invoice.supplier' },
          { key: 'items_count', label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–∑–∏—Ü—ñ–π', type: 'number', required: false, payloadPath: 'payload.invoice.items_count' }
        ],
        mockValues: {
          invoice_number: 'INV2026-0451',
          invoice_date: '2026-01-12',
          amount: '$12,450.00',
          currency: 'USD',
          supplier: 'ACME Supplies',
          items_count: '15'
        }
      },

      // BL Draft ‚Äî –¥—Ä–∞—Ñ—Ç –∫–æ–Ω–æ—Å–∞–º–µ–Ω—Ç—É
      BL_DRAFT: {
        name: 'Bill of Lading Draft',
        fields: [
          { key: 'bl_number', label: 'BL Number', type: 'text', required: true, payloadPath: 'payload.bl.number' },
          { key: 'shipper', label: 'Shipper', type: 'text', required: true, payloadPath: 'payload.bl.shipper' },
          { key: 'consignee', label: 'Consignee', type: 'text', required: true, payloadPath: 'payload.bl.consignee' },
          { key: 'notify_party', label: 'Notify Party', type: 'text', required: false, payloadPath: 'payload.bl.notify_party' },
          { key: 'port_of_loading', label: 'Port of Loading', type: 'text', required: true, payloadPath: 'payload.bl.pol' },
          { key: 'port_of_discharge', label: 'Port of Discharge', type: 'text', required: true, payloadPath: 'payload.bl.pod' },
          { key: 'vessel_name', label: 'Vessel Name', type: 'text', required: false, payloadPath: 'payload.bl.vessel' },
          { key: 'voyage_number', label: 'Voyage Number', type: 'text', required: false, payloadPath: 'payload.bl.voyage' }
        ],
        mockValues: {
          bl_number: 'MSKU1234567890',
          shipper: 'ACME Supplies Co.',
          consignee: 'TechImport LLC',
          notify_party: 'GT Import LLC',
          port_of_loading: 'Shanghai, China',
          port_of_discharge: 'Odessa, Ukraine',
          vessel_name: 'MSC AURORA',
          voyage_number: 'VY2026-15'
        }
      },

      // POA ‚Äî –¥–æ–≤—ñ—Ä–µ–Ω—ñ—Å—Ç—å
      POA: {
        name: 'Power of Attorney',
        fields: [
          { key: 'poa_number', label: '–ù–æ–º–µ—Ä –¥–æ–≤—ñ—Ä–µ–Ω–æ—Å—Ç—ñ', type: 'text', required: false, payloadPath: 'payload.poa.number' },
          { key: 'issue_date', label: '–î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ', type: 'date', required: true, payloadPath: 'payload.poa.issue_date' },
          { key: 'expiry_date', label: '–î—ñ–π—Å–Ω–∞ –¥–æ', type: 'date', required: true, payloadPath: 'payload.poa.expiry_date' },
          { key: 'principal', label: '–î–æ–≤—ñ—Ä–∏—Ç–µ–ª—å', type: 'text', required: true, payloadPath: 'payload.poa.principal' },
          { key: 'agent', label: '–ü—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏–∫', type: 'text', required: true, payloadPath: 'payload.poa.agent' },
          { key: 'notarized', label: '–ù–æ—Ç–∞—Ä—ñ–∞–ª—å–Ω–æ –∑–∞–≤—ñ—Ä–µ–Ω–æ', type: 'boolean', required: false, payloadPath: 'payload.poa.notarized' }
        ],
        mockValues: {
          poa_number: 'POA-2026-TI-001',
          issue_date: '2026-01-10',
          expiry_date: '2026-12-31',
          principal: '–¢–û–í ¬´–¢–µ—Ö–Ü–º–ø–æ—Ä—Ç¬ª / TechImport LLC',
          agent: '–¢–û–í ¬´–ì–¢ –Ü–º–ø–æ—Ä—Ç¬ª / GT Import LLC',
          notarized: '–¢–∞–∫'
        }
      },

      // CONTRACT ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç
      CONTRACT: {
        name: 'Contract',
        fields: [
          { key: 'contract_number', label: '–ù–æ–º–µ—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É', type: 'text', required: true, payloadPath: 'payload.contract.number' },
          { key: 'contract_date', label: '–î–∞—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É', type: 'date', required: true, payloadPath: 'payload.contract.date' },
          { key: 'seller', label: '–ü—Ä–æ–¥–∞–≤–µ—Ü—å', type: 'text', required: true, payloadPath: 'payload.contract.seller' },
          { key: 'buyer', label: '–ü–æ–∫—É–ø–µ—Ü—å', type: 'text', required: true, payloadPath: 'payload.contract.buyer' },
          { key: 'incoterms', label: 'Incoterms', type: 'select', options: ['FOB', 'CIF', 'CFR', 'EXW', 'DAP', 'DDP'], required: true, payloadPath: 'payload.contract.incoterms' },
          { key: 'total_value', label: '–°—É–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É', type: 'currency', required: true, payloadPath: 'payload.contract.value' }
        ],
        mockValues: {
          contract_number: 'CT-2026-0451',
          contract_date: '2026-01-05',
          seller: 'ACME Supplies Co.',
          buyer: 'TechImport LLC',
          incoterms: 'FOB',
          total_value: '$12,450.00'
        }
      },

      // EXPORT_DEC ‚Äî –µ–∫—Å–ø–æ—Ä—Ç–Ω–∞ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—è
      EXPORT_DEC: {
        name: 'Export Declaration',
        fields: [
          { key: 'declaration_number', label: '–ù–æ–º–µ—Ä –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—ó', type: 'text', required: true, payloadPath: 'payload.export_dec.number' },
          { key: 'declaration_date', label: '–î–∞—Ç–∞', type: 'date', required: true, payloadPath: 'payload.export_dec.date' },
          { key: 'customs_value', label: '–ú–∏—Ç–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å', type: 'currency', required: true, payloadPath: 'payload.export_dec.value' },
          { key: 'hs_code', label: 'HS Code', type: 'text', required: false, payloadPath: 'payload.export_dec.hs_code' }
        ],
        mockValues: {
          declaration_number: 'EXD-2026-001',
          declaration_date: '2026-01-20',
          customs_value: '$12,450.00',
          hs_code: '8532.24.0000'
        }
      },

      // CERTIFICATE ‚Äî —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
      CERTIFICATE: {
        name: 'Certificate',
        fields: [
          { key: 'cert_number', label: '–ù–æ–º–µ—Ä —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞', type: 'text', required: true, payloadPath: 'payload.certificate.number' },
          { key: 'cert_type', label: '–¢–∏–ø —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞', type: 'text', required: true, payloadPath: 'payload.certificate.type' },
          { key: 'issue_date', label: '–î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ', type: 'date', required: true, payloadPath: 'payload.certificate.issue_date' },
          { key: 'issuer', label: '–ö–∏–º –≤–∏–¥–∞–Ω–æ', type: 'text', required: true, payloadPath: 'payload.certificate.issuer' }
        ],
        mockValues: {
          cert_number: 'CERT-2026-001',
          cert_type: 'Certificate of Origin',
          issue_date: '2026-01-11',
          issuer: 'China Chamber of Commerce'
        }
      },

      // Default schema for unknown types
      _DEFAULT: {
        name: 'Document',
        fields: [
          { key: 'doc_type', label: '–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞', type: 'text', required: false },
          { key: 'source', label: '–î–∂–µ—Ä–µ–ª–æ', type: 'text', required: false },
          { key: 'status', label: '–°—Ç–∞—Ç—É—Å', type: 'text', required: false }
        ],
        mockValues: {}
      }
    };

    // ===== DOCUMENT VIEWER =====
    const DocumentViewer = {
      currentDoc: null,
      extractedFields: {}, // Store extracted fields for editing
      currentSchema: null, // Store current document schema

      init() {
        document.addEventListener('click', (e) => {
          const btn = e.target.closest('[data-doc-view]');
          if (btn) {
            e.preventDefault();
            e.stopPropagation();
            this.open(btn);
          }
        });
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.isOpen()) this.close();
        });
      },

      open(button) {
        const modal = document.getElementById('docViewerModal');
        if (!modal) return;

        this.currentDoc = {
          name: button.dataset.docName || '',
          type: button.dataset.docType || '',
          source: button.dataset.docSource || '',
          case: button.dataset.docCase || '',
          confidence: button.dataset.docConfidence || '',
          file: button.dataset.docFile || '',
          status: button.dataset.docStatus || 'NEEDS_VERIFICATION'
        };

        document.getElementById('docViewerFileName').textContent = this.currentDoc.name;
        document.getElementById('docViewerType').textContent = this.currentDoc.type;
        document.getElementById('docViewerSource').textContent = this.currentDoc.source;
        document.getElementById('docViewerCase').textContent = this.currentDoc.case;
        
        // Show confidence only if available (not for PROCESSING status)
        const confidenceEl = document.getElementById('docViewerConfidence');
        if (this.currentDoc.confidence) {
          confidenceEl.textContent = `${this.currentDoc.confidence}%`;
        } else {
          confidenceEl.textContent = '‚Äî';
        }

        this.renderPreview();
        this.renderExtractedData();
        this.updateActionsForStatus();
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
      },

      updateActionsForStatus() {
        const isVerified = this.currentDoc.status === 'VERIFIED';
        const isProcessing = this.currentDoc.status === 'PROCESSING';
        const isLowConfidence = this.currentDoc.status === 'LOW_CONFIDENCE';
        const isReadOnly = isVerified || isProcessing;

        // Get action elements
        const verifyBtn = document.querySelector('.doc-viewer-actions .btn-primary');
        const rejectBtn = document.querySelector('.doc-viewer-actions .btn-danger');
        const editBtn = document.getElementById('editExtractedBtn');
        const checkboxLabel = document.querySelector('.extracted-actions .checkbox-label');
        const commentSection = document.querySelector('.extracted-comment');

        // Show/hide based on status
        if (verifyBtn) verifyBtn.style.display = isReadOnly ? 'none' : 'flex';
        if (rejectBtn) rejectBtn.style.display = isReadOnly ? 'none' : 'flex';
        if (editBtn) editBtn.style.display = isReadOnly ? 'none' : 'flex';
        if (checkboxLabel) checkboxLabel.style.display = isReadOnly ? 'none' : 'flex';
        if (commentSection) commentSection.style.display = isReadOnly ? 'none' : 'block';

        // Add status badge to extracted data section
        const extractedHeader = document.querySelector('.extracted-header h4');
        if (extractedHeader) {
          // Remove any existing status indicator
          const existingStatus = extractedHeader.querySelector('.status-indicator');
          if (existingStatus) existingStatus.remove();

          if (isVerified) {
            const statusBadge = document.createElement('span');
            statusBadge.className = 'status-indicator';
            statusBadge.style.cssText = 'display: inline-flex; align-items: center; gap: 4px; margin-left: 8px; padding: 2px 8px; background: var(--success-bg); color: var(--success-text); border-radius: var(--radius-sm); font-size: 10px; font-weight: 500;';
            statusBadge.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              VERIFIED
            `;
            extractedHeader.appendChild(statusBadge);
          } else if (isProcessing) {
            const statusBadge = document.createElement('span');
            statusBadge.className = 'status-indicator';
            statusBadge.style.cssText = 'display: inline-flex; align-items: center; gap: 4px; margin-left: 8px; padding: 2px 8px; background: var(--accent-bg); color: var(--accent); border-radius: var(--radius-sm); font-size: 10px; font-weight: 500;';
            statusBadge.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              PROCESSING
            `;
            extractedHeader.appendChild(statusBadge);
          } else if (isLowConfidence) {
            const statusBadge = document.createElement('span');
            statusBadge.className = 'status-indicator';
            statusBadge.style.cssText = 'display: inline-flex; align-items: center; gap: 4px; margin-left: 8px; padding: 2px 8px; background: var(--danger-bg); color: var(--danger); border-radius: var(--radius-sm); font-size: 10px; font-weight: 500;';
            statusBadge.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
              PRIORITY REVIEW
            `;
            extractedHeader.appendChild(statusBadge);
          }
        }

        // Show processing message if still processing
        const extractedFields = document.getElementById('extractedFields');
        if (extractedFields && isProcessing) {
          extractedFields.innerHTML = `
            <div style="text-align: center; padding: 24px; color: var(--text-muted);">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite; margin-bottom: 12px;">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <div style="font-size: 14px; margin-bottom: 4px;">AI –æ–±—Ä–æ–±–ª—è—î –¥–æ–∫—É–º–µ–Ω—Ç...</div>
              <div style="font-size: 12px;">–î–∞–Ω—ñ –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏</div>
            </div>
          `;
        }
      },

      async renderPreview() {
        const preview = document.getElementById('docViewerPreview');
        if (!preview || !this.currentDoc) return;

        // Show loading state
        preview.innerHTML = `
          <div class="preview-info">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <div style="font-size: 14px; margin-top: 12px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞...</div>
          </div>
        `;

        const fileName = this.currentDoc.file || this.currentDoc.name;
        const isExcel = this.currentDoc.name.endsWith('.xlsx') || this.currentDoc.name.endsWith('.xls');
        const isPdf = this.currentDoc.name.endsWith('.pdf') || (fileName && fileName.endsWith('.pdf'));

        if (isExcel && fileName) {
          // Render Excel file
          try {
            await this.renderExcelFile(preview, fileName);
          } catch (error) {
            console.error('Error loading Excel file:', error);
            this.renderFallbackPreview(preview);
          }
        } else if (isPdf && fileName) {
          // Render PDF file using iframe
          this.renderPdfFile(preview, fileName);
        } else {
          // Fallback for other file types
          this.renderFallbackPreview(preview);
        }
      },

      renderPdfFile(container, fileName) {
        container.innerHTML = `
          <iframe 
            src="${encodeURI(fileName)}" 
            style="width: 100%; height: 100%; min-height: 500px; border: none; border-radius: var(--radius-sm);"
            title="PDF Preview"
          ></iframe>
        `;
      },

      renderFallbackPreview(container) {
        container.innerHTML = `
          <div class="preview-info">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            <div style="font-size: 14px; margin-bottom: 8px;">–î–æ–∫—É–º–µ–Ω—Ç: ${this.currentDoc.name}</div>
            <div style="font-size: 12px; color: var(--text-muted);">–î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–æ–≤–Ω–æ–≥–æ –≤–º—ñ—Å—Ç—É –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª</div>
          </div>
        `;
      },

      async renderExcelFile(container, fileName) {
        // Check if SheetJS is available
        if (typeof XLSX === 'undefined') {
          throw new Error('SheetJS library not loaded');
        }

        // Fetch the Excel file
        const response = await fetch(fileName);
        if (!response.ok) {
          throw new Error(`Failed to load file: ${response.statusText}`);
        }

        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });

        // Get the first sheet
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];

        // Convert to HTML table
        const html = XLSX.utils.sheet_to_html(worksheet, {
          id: 'excel-table',
          editable: false
        });

        // Style the table
        container.innerHTML = `
          <div style="overflow-x: auto;">
            <style>
              #excel-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 13px;
              }
              #excel-table th {
                background: var(--bg-hover);
                font-weight: 600;
                color: var(--text);
                padding: 8px 12px;
                text-align: left;
                border-bottom: 2px solid var(--divider);
                position: sticky;
                top: 0;
                z-index: 10;
              }
              #excel-table td {
                padding: 8px 12px;
                border-bottom: 1px solid var(--divider);
                color: var(--text-secondary);
              }
              #excel-table tr:hover {
                background: var(--bg-hover);
              }
              #excel-table tr:last-child td {
                border-bottom: none;
              }
            </style>
            ${html}
          </div>
        `;
      },

      close() {
        const modal = document.getElementById('docViewerModal');
        if (modal) modal.style.display = 'none';
        document.body.style.overflow = '';
        this.currentDoc = null;
      },

      isOpen() {
        const modal = document.getElementById('docViewerModal');
        return modal && modal.style.display !== 'none';
      },

      download() {
        if (!this.currentDoc || !this.currentDoc.file) {
          alert('–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è —Å–∫–∞—á—É–≤–∞–Ω–Ω—è');
          return;
        }
        const link = document.createElement('a');
        link.href = this.currentDoc.file;
        link.download = this.currentDoc.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      },

      renderExtractedData() {
        const extractedContainer = document.getElementById('extractedFields');
        const confidenceBadge = document.getElementById('extractedConfidenceBadge');
        const confidence = parseInt(this.currentDoc.confidence) || 0;
        const isProcessing = this.currentDoc.status === 'PROCESSING';
        
        // Set confidence badge (hide for PROCESSING status)
        if (isProcessing || !this.currentDoc.confidence) {
          confidenceBadge.style.display = 'none';
        } else {
          confidenceBadge.style.display = 'inline-flex';
          confidenceBadge.textContent = `${confidence}% confidence`;
          confidenceBadge.className = 'extracted-badge';
          if (confidence >= 95) confidenceBadge.classList.add('high');
          else if (confidence >= 85) confidenceBadge.classList.add('medium');
          else confidenceBadge.classList.add('low');
        }

        // Get schema for document type (use DEFAULT if not found)
        this.currentSchema = DOC_TYPE_SCHEMAS[this.currentDoc.type] || DOC_TYPE_SCHEMAS._DEFAULT;
        
        // Build extracted fields from schema
        const extractedFields = {};
        this.currentSchema.fields.forEach(field => {
          // Get value from mock data or use placeholder for default schema
          let value = this.currentSchema.mockValues[field.key];
          
          // For default schema, use document info
          if (!value && this.currentDoc.type && this.currentSchema === DOC_TYPE_SCHEMAS._DEFAULT) {
            if (field.key === 'doc_type') value = this.currentDoc.type;
            else if (field.key === 'source') value = this.currentDoc.source;
            else if (field.key === 'status') value = 'NEEDS_VERIFICATION';
          }
          
          extractedFields[field.label] = value || '‚Äî';
        });

        // Store extracted fields for editing (with schema reference)
        this.extractedFields = extractedFields;

        // Render fields
        this.renderExtractedFields(extractedFields, extractedContainer);

        // Reset checkbox and comment
        document.getElementById('extractedDataCorrect').checked = false;
        document.getElementById('verificationComment').value = '';
      },

      renderExtractedFields(fields, container) {
        container.innerHTML = Object.entries(fields).map(([label, value]) => {
          // Find field config from schema for styling
          const fieldConfig = this.currentSchema?.fields.find(f => f.label === label);
          const isRequired = fieldConfig?.required;
          const fieldType = fieldConfig?.type || 'text';
          
          return `
            <div class="extracted-field">
              <div class="extracted-field-label">
                ${label}
                ${isRequired ? '<span style="color: var(--danger); margin-left: 2px;">*</span>' : ''}
              </div>
              <div class="extracted-field-value" data-field-type="${fieldType}">${value}</div>
            </div>
          `;
        }).join('');
      },

      editExtracted() {
        const editModal = document.getElementById('editExtractedModal');
        const docNameSpan = document.getElementById('editDocName');
        const fieldsContainer = document.getElementById('editExtractedFields');
        
        if (!editModal || !docNameSpan || !fieldsContainer) return;

        docNameSpan.textContent = this.currentDoc.name;

        // Render editable fields based on schema
        fieldsContainer.innerHTML = Object.entries(this.extractedFields).map(([label, value], index) => {
          const fieldId = `edit-field-${index}`;
          const fieldConfig = this.currentSchema?.fields.find(f => f.label === label);
          const fieldType = fieldConfig?.type || 'text';
          const isRequired = fieldConfig?.required;
          const options = fieldConfig?.options || [];

          let inputHtml = '';
          const baseStyle = 'width: 100%; padding: 8px 12px; border: 1px solid var(--divider); border-radius: var(--radius-sm); background: var(--bg-panel); color: var(--text); font-family: inherit; font-size: 13px; transition: border-color 0.2s;';

          if (fieldType === 'select' && options.length > 0) {
            // Select dropdown
            inputHtml = `
              <select 
                id="${fieldId}" 
                data-field-label="${label}"
                style="${baseStyle} cursor: pointer;"
                onfocus="this.style.borderColor='var(--accent)'"
                onblur="this.style.borderColor='var(--divider)'"
              >
                ${options.map(opt => `<option value="${opt}" ${opt === value ? 'selected' : ''}>${opt}</option>`).join('')}
              </select>
            `;
          } else if (fieldType === 'boolean') {
            // Checkbox for boolean
            const isChecked = value === '–¢–∞–∫' || value === 'true' || value === true;
            inputHtml = `
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input 
                  type="checkbox" 
                  id="${fieldId}" 
                  data-field-label="${label}"
                  data-field-type="boolean"
                  ${isChecked ? 'checked' : ''}
                  style="width: 18px; height: 18px; cursor: pointer;"
                />
                <span style="font-size: 13px; color: var(--text);">–¢–∞–∫</span>
              </label>
            `;
          } else if (fieldType === 'date') {
            // Date input
            inputHtml = `
              <input 
                type="date" 
                id="${fieldId}" 
                value="${value}" 
                data-field-label="${label}"
                style="${baseStyle}"
                onfocus="this.style.borderColor='var(--accent)'"
                onblur="this.style.borderColor='var(--divider)'"
              />
            `;
          } else if (fieldType === 'number') {
            // Number input
            inputHtml = `
              <input 
                type="number" 
                id="${fieldId}" 
                value="${value}" 
                data-field-label="${label}"
                step="any"
                style="${baseStyle}"
                onfocus="this.style.borderColor='var(--accent)'"
                onblur="this.style.borderColor='var(--divider)'"
              />
            `;
          } else {
            // Default text input
            inputHtml = `
              <input 
                type="text" 
                id="${fieldId}" 
                value="${value}" 
                data-field-label="${label}"
                style="${baseStyle}"
                onfocus="this.style.borderColor='var(--accent)'"
                onblur="this.style.borderColor='var(--divider)'"
              />
            `;
          }

          return `
            <div style="margin-bottom: 16px;">
              <label style="display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 6px; font-weight: 500;">
                ${label}
                ${isRequired ? '<span style="color: var(--danger); margin-left: 2px;">*</span>' : ''}
              </label>
              ${inputHtml}
            </div>
          `;
        }).join('');

        editModal.style.display = 'flex';
      },

      cancelEdit() {
        const editModal = document.getElementById('editExtractedModal');
        if (editModal) editModal.style.display = 'none';
      },

      saveEdited() {
        const fieldsContainer = document.getElementById('editExtractedFields');
        if (!fieldsContainer) return;

        // Collect edited values from all input types
        const editedFields = {};
        
        // Handle text, number, date inputs
        const inputs = fieldsContainer.querySelectorAll('input[data-field-label]');
        inputs.forEach(input => {
          const label = input.dataset.fieldLabel;
          const isBoolean = input.dataset.fieldType === 'boolean';
          
          if (isBoolean) {
            editedFields[label] = input.checked ? '–¢–∞–∫' : '–ù—ñ';
          } else {
            editedFields[label] = input.value.trim();
          }
        });

        // Handle select dropdowns
        const selects = fieldsContainer.querySelectorAll('select[data-field-label]');
        selects.forEach(select => {
          const label = select.dataset.fieldLabel;
          editedFields[label] = select.value;
        });

        // Update stored fields
        this.extractedFields = editedFields;

        // Update display
        const extractedContainer = document.getElementById('extractedFields');
        if (extractedContainer) {
          this.renderExtractedFields(editedFields, extractedContainer);
        }

        // Close modal
        this.cancelEdit();

        // Show success message
        alert('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–∏ –ø–µ—Ä–µ–¥ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é.');
      },

      verify() {
        const isCorrect = document.getElementById('extractedDataCorrect').checked;
        const comment = document.getElementById('verificationComment').value.trim();

        if (!isCorrect) {
          alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –ø—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é');
          return;
        }

        // –¢—É—Ç –±—É–¥–µ API call –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
        console.log('Verifying document:', {
          docName: this.currentDoc.name,
          docId: this.currentDoc.id,
          comment: comment,
          action: 'VERIFIED'
        });

        alert(`–î–æ–∫—É–º–µ–Ω—Ç "${this.currentDoc.name}" —É—Å–ø—ñ—à–Ω–æ –≤–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ!${comment ? '\n\n–ö–æ–º–µ–Ω—Ç–∞—Ä: ' + comment : ''}`);
        
        this.close();
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω
        setTimeout(() => {
          location.reload();
        }, 500);
      },

      reject() {
        const rejectModal = document.getElementById('rejectReasonModal');
        const docNameSpan = document.getElementById('rejectDocName');
        const reasonInput = document.getElementById('rejectReasonInput');
        
        if (rejectModal && docNameSpan && reasonInput) {
          docNameSpan.textContent = this.currentDoc.name;
          reasonInput.value = '';
          rejectModal.style.display = 'flex';
        }
      },

      cancelReject() {
        const rejectModal = document.getElementById('rejectReasonModal');
        const reasonInput = document.getElementById('rejectReasonInput');
        if (rejectModal) rejectModal.style.display = 'none';
        if (reasonInput) reasonInput.value = '';
      },

      confirmReject() {
        const reasonInput = document.getElementById('rejectReasonInput');
        const rejectModal = document.getElementById('rejectReasonModal');
        
        if (!reasonInput) return;
        
        const reason = reasonInput.value.trim();
        if (!reason) {
          alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è');
          return;
        }

        // –¢—É—Ç –±—É–¥–µ API call –¥–ª—è –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è
        console.log('Rejecting document:', {
          docName: this.currentDoc.name,
          docId: this.currentDoc.id,
          reason: reason,
          action: 'REJECTED'
        });

        // –°–∏–º—É–ª—è—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è
        if (rejectModal) rejectModal.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
        alert(`–î–æ–∫—É–º–µ–Ω—Ç "${this.currentDoc.name}" –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ.\n\n–ü—Ä–∏—á–∏–Ω–∞: ${reason}\n\n–î–æ–∫—É–º–µ–Ω—Ç –ø–æ—Ç—Ä–µ–±—É—î –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.`);
        
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –æ—Å–Ω–æ–≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        this.close();
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω (–≤ —Ä–µ–∞–ª—å–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ —Ü–µ –±—É–¥–µ —á–µ—Ä–µ–∑ state management)
        setTimeout(() => {
          location.reload();
        }, 500);
      }
    };

    // ===== UPLOAD MODAL =====
    const UploadModal = {
      selectedFiles: [],
      dropZone: null,
      fileInput: null,

      init() {
        const modal = document.getElementById('uploadModal');
        if (!modal) return;

        // Bind header button
        const uploadBtn = document.querySelector('[data-upload-trigger]');
        if (uploadBtn) {
          uploadBtn.onclick = (e) => {
            e.preventDefault();
            this.open();
          };
        }

        // Get elements
        this.dropZone = document.getElementById('uploadDropZone');
        this.fileInput = document.getElementById('uploadFileInput');

        if (!this.dropZone || !this.fileInput) return;

        // Click to select files
        this.dropZone.onclick = () => this.fileInput.click();

        // File input change
        this.fileInput.onchange = (e) => {
          this.handleFiles(Array.from(e.target.files));
        };

        // Drag and drop
        this.dropZone.ondragover = (e) => {
          e.preventDefault();
          this.dropZone.classList.add('drag-over');
        };

        this.dropZone.ondragleave = () => {
          this.dropZone.classList.remove('drag-over');
        };

        this.dropZone.ondrop = (e) => {
          e.preventDefault();
          this.dropZone.classList.remove('drag-over');
          const files = Array.from(e.dataTransfer.files);
          this.handleFiles(files);
        };

        // ESC to close
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.isOpen()) {
            this.close();
          }
        });
      },

      open() {
        const modal = document.getElementById('uploadModal');
        if (modal) {
          modal.style.display = 'block';
          document.body.style.overflow = 'hidden';
          this.selectedFiles = [];
          this.renderFiles();
        }
      },

      close() {
        const modal = document.getElementById('uploadModal');
        if (modal) {
          modal.style.display = 'none';
          document.body.style.overflow = '';
          this.selectedFiles = [];
          this.fileInput.value = '';
          this.renderFiles();
          // Reset form
          document.getElementById('uploadCaseSelect').value = '';
          document.getElementById('uploadDocTypeSelect').value = '';
        }
      },

      isOpen() {
        const modal = document.getElementById('uploadModal');
        return modal && modal.style.display !== 'none';
      },

      handleFiles(files) {
        const validFiles = files.filter(file => {
          // Check file type
          const validExtensions = ['.pdf', '.xlsx', '.xls', '.docx', '.doc', '.png', '.jpg', '.jpeg'];
          const extension = '.' + file.name.split('.').pop().toLowerCase();
          if (!validExtensions.includes(extension)) {
            alert(`–§–∞–π–ª "${file.name}" –º–∞—î –Ω–µ–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç. –ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è: PDF, XLSX, DOCX, PNG, JPG`);
            return false;
          }

          // Check file size (10MB)
          const maxSize = 10 * 1024 * 1024;
          if (file.size > maxSize) {
            alert(`–§–∞–π–ª "${file.name}" –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π (${(file.size / 1024 / 1024).toFixed(2)}MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä: 10MB`);
            return false;
          }

          return true;
        });

        // Add to selected files (avoid duplicates)
        validFiles.forEach(file => {
          if (!this.selectedFiles.find(f => f.name === file.name && f.size === file.size)) {
            this.selectedFiles.push(file);
          }
        });

        this.renderFiles();
      },

      removeFile(index) {
        this.selectedFiles.splice(index, 1);
        this.renderFiles();
      },

      renderFiles() {
        const preview = document.getElementById('uploadFilesPreview');
        const list = document.getElementById('uploadFilesList');

        if (!preview || !list) return;

        if (this.selectedFiles.length === 0) {
          preview.style.display = 'none';
          return;
        }

        preview.style.display = 'block';
        list.innerHTML = this.selectedFiles.map((file, index) => {
          const size = file.size < 1024 
            ? `${file.size} B` 
            : file.size < 1024 * 1024 
            ? `${(file.size / 1024).toFixed(1)} KB` 
            : `${(file.size / 1024 / 1024).toFixed(2)} MB`;
          
          const extension = '.' + file.name.split('.').pop().toLowerCase();
          const icon = extension === '.pdf' ? 'üìÑ' : 
                      ['.xlsx', '.xls'].includes(extension) ? 'üìä' :
                      ['.docx', '.doc'].includes(extension) ? 'üìù' :
                      ['.png', '.jpg', '.jpeg'].includes(extension) ? 'üñºÔ∏è' : 'üìé';

          return `
            <div class="upload-file-item">
              <div class="upload-file-info">
                <div class="upload-file-icon">${icon}</div>
                <div class="upload-file-details">
                  <div class="upload-file-name">${file.name}</div>
                  <div class="upload-file-size">${size}</div>
                </div>
              </div>
              <button class="upload-file-remove" onclick="UploadModal.removeFile(${index})" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
          `;
        }).join('');
      },

      upload() {
        // Validation
        if (this.selectedFiles.length === 0) {
          alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
          return;
        }

        const caseSelect = document.getElementById('uploadCaseSelect');
        if (!caseSelect || !caseSelect.value) {
          alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –∫–µ–π—Å');
          return;
        }

        const docTypeSelect = document.getElementById('uploadDocTypeSelect');
        const docType = docTypeSelect ? docTypeSelect.value : '';

        // Demo upload simulation
        const fileNames = this.selectedFiles.map(f => f.name).join(', ');
        const caseNumber = caseSelect.value;
        const docTypeText = docType ? ` (${docType})` : '';

        console.log('Uploading files:', {
          files: this.selectedFiles.map(f => ({ name: f.name, size: f.size })),
          case: caseNumber,
          docType: docType || 'AUTO'
        });

        // Show loading state
        const uploadBtn = document.querySelector('.upload-modal-actions .btn-primary');
        const originalText = uploadBtn.innerHTML;
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';

        // Simulate upload delay
        setTimeout(() => {
          // Show toast notification
          this.showToast(`–£—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${this.selectedFiles.length} ${this.selectedFiles.length === 1 ? '—Ñ–∞–π–ª' : '—Ñ–∞–π–ª—ñ–≤'}`);

          // Close modal
          this.close();

          // Reset button
          uploadBtn.disabled = false;
          uploadBtn.innerHTML = originalText;

          // In real app, this would refresh the page or update the document list
          // For demo, we'll just show a message
          setTimeout(() => {
            alert(`–î–µ–º–æ: ${this.selectedFiles.length} —Ñ–∞–π–ª(—ñ–≤) "${fileNames}" –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–ª—è –∫–µ–π—Å—É ${caseNumber}${docTypeText}.\n\n–í —Ä–µ–∞–ª—å–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ:\n- –§–∞–π–ª–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä\n- –°—Ç–∞—Ç—É—Å = UPLOADED\n- n8n —Ç—Ä–∏–≥–µ—Ä ‚Üí AI –æ–±—Ä–æ–±–∫–∞\n- –°—Ç–∞—Ç—É—Å ‚Üí PROCESSING ‚Üí NEEDS_VERIFICATION\n- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –æ–Ω–æ–≤–∏—Ç—å—Å—è –∑ –Ω–æ–≤–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏`);
          }, 300);
        }, 1500);
      },

      showToast(message) {
        // Create toast element
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          bottom: 24px;
          right: 24px;
          background: var(--success-bg, #10b981);
          color: white;
          padding: 12px 20px;
          border-radius: var(--radius-md, 8px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          z-index: 10000;
          font-size: 14px;
          animation: slideIn 0.3s ease-out;
        `;
        toast.textContent = message;
        document.body.appendChild(toast);

        // Remove after 3 seconds
        setTimeout(() => {
          toast.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
    };

    // Init
    document.addEventListener('DOMContentLoaded', () => { 
      TipsManager.init(); 
      HelpManager.init(); 
      DocumentViewer.init();
      UploadModal.init();
    });
  </script>

  <!-- Upload Modal -->
  <div id="uploadModal" class="upload-modal" style="display: none;">
    <div class="upload-modal-overlay" onclick="UploadModal.close()"></div>
    <div class="upload-modal-content" onclick="event.stopPropagation()">
      <div class="upload-modal-header">
        <h3>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</h3>
        <button class="upload-modal-close" onclick="UploadModal.close()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="upload-modal-body">
        <!-- Drag and Drop Zone -->
        <div id="uploadDropZone" class="upload-drop-zone">
          <input type="file" id="uploadFileInput" multiple accept=".pdf,.xlsx,.xls,.docx,.doc,.png,.jpg,.jpeg" style="display: none;">
          <div class="upload-drop-content">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent); margin-bottom: 12px;">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="12" y1="18" x2="12" y2="12"/>
              <line x1="9" y1="15" x2="15" y2="15"/>
            </svg>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 4px;">–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª–∏ —Å—é–¥–∏</div>
            <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 12px;">–∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É</div>
            <div style="font-size: 12px; color: var(--text-secondary);">PDF, XLSX, DOCX, PNG, JPG (–¥–æ 10MB)</div>
          </div>
        </div>

        <!-- Selected Files Preview -->
        <div id="uploadFilesPreview" class="upload-files-preview" style="display: none;">
          <div style="font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--text);">–í–∏–±—Ä–∞–Ω—ñ —Ñ–∞–π–ª–∏:</div>
          <div id="uploadFilesList" class="upload-files-list"></div>
        </div>

        <!-- Case Selection -->
        <div class="upload-field">
          <label style="font-size: 13px; font-weight: 500; margin-bottom: 8px; display: block; color: var(--text);">
            –ö–µ–π—Å <span style="color: var(--danger);">*</span>
          </label>
          <select id="uploadCaseSelect" class="upload-select" required>
            <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–µ–π—Å...</option>
            <option value="F1-SEA-2026-02448">F1-SEA-2026-02448</option>
            <option value="F1-SEA-2026-02451">F1-SEA-2026-02451</option>
            <option value="F1-SEA-2026-02445">F1-SEA-2026-02445</option>
            <option value="F1-SEA-2026-02452">F1-SEA-2026-02452</option>
          </select>
        </div>

        <!-- Document Type Selection (Optional) -->
        <div class="upload-field">
          <label style="font-size: 13px; font-weight: 500; margin-bottom: 8px; display: block; color: var(--text);">
            –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ <span style="font-size: 11px; color: var(--text-muted); font-weight: normal;">(–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</span>
          </label>
          <select id="uploadDocTypeSelect" class="upload-select">
            <option value="">AI –≤–∏–∑–Ω–∞—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</option>
            <option value="INVOICE">INVOICE</option>
            <option value="PACKING_LIST">PACKING_LIST</option>
            <option value="BL_DRAFT">BL_DRAFT</option>
            <option value="POA">POA</option>
            <option value="CERTIFICATE">CERTIFICATE</option>
            <option value="OTHER">OTHER</option>
          </select>
        </div>
      </div>
      <div class="upload-modal-actions">
        <button class="btn btn-secondary" onclick="UploadModal.close()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button class="btn btn-primary" onclick="UploadModal.upload()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
        </button>
      </div>
    </div>
  </div>
</body>
</html>
